<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Corey S. Sparks, PhD">
<meta name="dcterms.date" content="2022-10-13">

<title>DEM 7223 - Event History Analysis - Discrete Time Hazard Model 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="EX7_DiscreteTime_2_22_files/libs/clipboard/clipboard.min.js"></script>
<script src="EX7_DiscreteTime_2_22_files/libs/quarto-html/quarto.js"></script>
<script src="EX7_DiscreteTime_2_22_files/libs/quarto-html/popper.min.js"></script>
<script src="EX7_DiscreteTime_2_22_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="EX7_DiscreteTime_2_22_files/libs/quarto-html/anchor.min.js"></script>
<link href="EX7_DiscreteTime_2_22_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EX7_DiscreteTime_2_22_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="EX7_DiscreteTime_2_22_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="EX7_DiscreteTime_2_22_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="EX7_DiscreteTime_2_22_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<link href="EX7_DiscreteTime_2_22_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="EX7_DiscreteTime_2_22_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#notes" id="toc-notes" class="nav-link active" data-scroll-target="#notes">Notes</a>
  <ul class="collapse">
  <li><a href="#alternative-time-specifications" id="toc-alternative-time-specifications" class="nav-link" data-scroll-target="#alternative-time-specifications">Alternative time specifications</a></li>
  <li><a href="#comparing-model-fit-for-different-time-specifications" id="toc-comparing-model-fit-for-different-time-specifications" class="nav-link" data-scroll-target="#comparing-model-fit-for-different-time-specifications">Comparing model fit for different time specifications</a></li>
  <li><a href="#constructing-survival-curves-for-the-discrete-time-model" id="toc-constructing-survival-curves-for-the-discrete-time-model" class="nav-link" data-scroll-target="#constructing-survival-curves-for-the-discrete-time-model">Constructing Survival Curves for the discrete time model</a></li>
  </ul></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#continuous-duration-outcome---dhs-data" id="toc-continuous-duration-outcome---dhs-data" class="nav-link" data-scroll-target="#continuous-duration-outcome---dhs-data">Continuous duration outcome - DHS data</a>
  <ul class="collapse">
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data">load the data</a></li>
  <li><a href="#event---second-birth-occurrence" id="toc-event---second-birth-occurrence" class="nav-link" data-scroll-target="#event---second-birth-occurrence">Event - Second birth occurrence</a>
  <ul class="collapse">
  <li><a href="#create-the-person-period-file" id="toc-create-the-person-period-file" class="nav-link" data-scroll-target="#create-the-person-period-file">Create the person-period file</a></li>
  <li><a href="#discrete-time-model" id="toc-discrete-time-model" class="nav-link" data-scroll-target="#discrete-time-model">Discrete time model</a></li>
  <li><a href="#plot-the-survival-function-estimate" id="toc-plot-the-survival-function-estimate" class="nav-link" data-scroll-target="#plot-the-survival-function-estimate">Plot the survival function estimate</a></li>
  <li><a href="#alternative-time-specifications-1" id="toc-alternative-time-specifications-1" class="nav-link" data-scroll-target="#alternative-time-specifications-1">Alternative time specifications</a></li>
  </ul></li>
  <li><a href="#ipums-nhis-mortality-example" id="toc-ipums-nhis-mortality-example" class="nav-link" data-scroll-target="#ipums-nhis-mortality-example">IPUMS NHIS Mortality example</a>
  <ul class="collapse">
  <li><a href="#alternative-codings-of-failure-time" id="toc-alternative-codings-of-failure-time" class="nav-link" data-scroll-target="#alternative-codings-of-failure-time">alternative codings of failure time</a></li>
  <li><a href="#create-person---period-file" id="toc-create-person---period-file" class="nav-link" data-scroll-target="#create-person---period-file">Create person - period file</a></li>
  </ul></li>
  <li><a href="#generate-hazard-plots" id="toc-generate-hazard-plots" class="nav-link" data-scroll-target="#generate-hazard-plots">Generate hazard plots</a>
  <ul class="collapse">
  <li><a href="#model-fits" id="toc-model-fits" class="nav-link" data-scroll-target="#model-fits">Model fits</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">DEM 7223 - Event History Analysis - Discrete Time Hazard Model 2</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://coreysparks.github.io">Corey S. Sparks, PhD</a> 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://hcap.utsa.edu/demography">The University of Texas at San Antonio</a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 13, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="notes" class="level1">
<h1>Notes</h1>
<p>As we saw last week, when we fit the discrete time hazards model to the person-period data, we fit the model:</p>
<p><span class="math display">\[logit(h(t))=\alpha_j+x'\beta\]</span></p>
<p>Where the <span class="math inline">\(\alpha_j\)</span>’s represent the logit-hazard for the distinct risk periods, and the <span class="math inline">\(\beta\)</span>’s represent the effects of covariates on the hazard.</p>
<p>This formulation is called the “general” form because it allows the shape of the hazard function to vary at each time point, as defined by the <span class="math inline">\(\alpha_j\)</span>’s!</p>
<p>This allows great flexibility in modeling the changing nature of risk</p>
<p>This model specification by definition sets no constraints on the shape of the baseline function because we estimate the hazard at every time point.</p>
<p>This specification is:</p>
<ul>
<li><p>Easily interpretable in multiple scales</p></li>
<li><p>Informative about the shape of the hazard function</p></li>
<li><p>Consistent with estimates from life tables</p>
<ul>
<li>If we include no predictors, we basically estimate the life table <span class="math inline">\(q(x)\)</span></li>
</ul></li>
</ul>
<section id="alternative-time-specifications" class="level3">
<h3 class="anchored" data-anchor-id="alternative-time-specifications">Alternative time specifications</h3>
<p>We can specify alternative ways of modeling the hazard function</p>
<p>Instead of having one <span class="math inline">\(\alpha_j\)</span> for each time point, we may be able to capture the shape of the hazard with fewer parameters.</p>
<p>Because the general model is not parsimonious, the estimates of the baseline hazard can fluctuate dramatically from time to time owing solely to sampling variation</p>
<p>Also, if there are not many failures at particular times, we can have low certainty about the parameter estimate</p>
<p>Although time in the general model is treated discretely, we can specify continuous time models as well by specifying time as a continuous, rather than a categorical predictor in our model</p>
<p>This is done by assuming time is either:</p>
<ul>
<li><p>Constant – hazard is constant at all time, time is not in the model at all</p></li>
<li><p>Linear – hazard increases/decreases with time</p></li>
<li><p>Quadratic – hazard is a nonlinear curve over time with 1 inflection point</p></li>
<li><p>Cubic – hazard is nonlinear over time with 2 inflection points</p></li>
<li><p>Higher order – hazard is nonlinear over time with &gt;2 inflection points</p></li>
<li><p>Spline basis – nonlinear but not specifically using polynomials</p></li>
</ul>
<p>Each of these models specifies a more parsimonious version of the general form, with fewer parameters, <em>if the number of time points is large</em></p>
<p>But, they will never fit the data as well as the general model</p>
</section>
<section id="comparing-model-fit-for-different-time-specifications" class="level3">
<h3 class="anchored" data-anchor-id="comparing-model-fit-for-different-time-specifications">Comparing model fit for different time specifications</h3>
<p>To compare discrete time models we use standard model comparison methods</p>
<ul>
<li><p>Model Deviance = (-2*log likelihood)</p></li>
<li><p>Model AIC = (-2 log likelihood + 2*(p+1))</p></li>
</ul>
<p>For example, if we fit the constant hazard, the linear hazard, a cubic hazard and a quartic hazard, we compare the performance of each model to the performance of the general model (with 1 parameter for each time point)</p>
<p>We get:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="C:/Users/ozd504/Documents/Github/DEM7223/images/aictab.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">AIC Table</figcaption><p></p>
</figure>
</div>
<p>We see the General model is the best fitting, but the quartic model is the next best.</p>
</section>
<section id="constructing-survival-curves-for-the-discrete-time-model" class="level2">
<h2 class="anchored" data-anchor-id="constructing-survival-curves-for-the-discrete-time-model">Constructing Survival Curves for the discrete time model</h2>
<p>We have seen how to plot the hazard function for the discrete time model, but we can also plot the survival function estimates as well.</p>
<p>If we use the product-limit estimator, then we can estimate survival to time t as:</p>
<p><span class="math display">\[S(t) = S_{t-1} * (1-h_t)\]</span></p>
</section>
</section>
<section id="examples" class="level1">
<h1>Examples</h1>
<p>This example will illustrate how to fit the discrete time hazard model to person-period data. Specifically, this example illustrates various parameterizartions of time in the discrete time model. In this example, I will use the event of a couple having a second birth. The data for this example come from the data <a href="http://www.dhsprogram.com/data/model-datasets.cfm">Demographic and Health Survey for 2012</a> children’s recode file. This file contains information for all births in the last 5 years prior to the survey.</p>
<p>The second example will use data from the <a href="https://nhis.ipums.org/nhis/">IPUMS NHIS</a> and examine alternative methods for coding time between survey and mortality follow up.</p>
</section>
<section id="continuous-duration-outcome---dhs-data" class="level1">
<h1>Continuous duration outcome - DHS data</h1>
<section id="load-the-data" class="level3">
<h3 class="anchored" data-anchor-id="load-the-data">load the data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.3.6      ✔ purrr   0.3.4 
✔ tibble  3.1.8      ✔ dplyr   1.0.10
✔ tidyr   1.2.0      ✔ stringr 1.4.1 
✔ readr   2.1.2      ✔ forcats 0.5.2 
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#load the data</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">read_dta</span>(<span class="st">"../data/ZAIR71FL.DTA"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">zap_labels</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="event---second-birth-occurrence" class="level2">
<h2 class="anchored" data-anchor-id="event---second-birth-occurrence">Event - Second birth occurrence</h2>
<p>In the DHS individual recode file, information on every live birth is collected using a retrospective birth history survey mechanism.</p>
<p>Since our outcome is time between first and second birth, we must select as our risk set, only women who have had a first birth.</p>
<p>The <code>bidx</code> variable indexes the birth history and if <code>bidx_01</code> is not missing, then the woman should be at risk of having a second birth (i.e.&nbsp;she has had a first birth, i.e.&nbsp;<code>bidx_01==1</code>).</p>
<p>I also select only non-twin births (<code>b0 == 0</code>).</p>
<p>The DHS provides the dates of when each child was born in Century Month Codes.</p>
<p>To get the interval for women who <em>actually had</em> a second birth, that is the difference between the CMC for the first birth <code>b3_01</code> and the second birth <code>b3_02</code>, but for women who had not had a second birth by the time of the interview, the censored time between births is the difference between <code>b3_01</code> and <code>v008</code>, the date of the interview.</p>
<p>We have 6124 women who are at risk of a second birth.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>sub<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bidx_01<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>b0_01<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">CASEID=</span>caseid, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">int.cmc=</span>v008,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fbir.cmc=</span>b3_01,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sbir.cmc=</span>b3_02,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">marr.cmc=</span>v509,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">rural=</span>v025,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">educ=</span>v106,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">age =</span> v012,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">agec=</span><span class="fu">cut</span>(v012, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">50</span>,<span class="dv">5</span>), <span class="at">include.lowest=</span>T),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">partneredu=</span>v701,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">partnerage=</span>v730,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">weight=</span>v005<span class="sc">/</span><span class="dv">1000000</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">psu=</span>v021,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">strata=</span>v022)<span class="sc">%&gt;%</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CASEID, int.cmc, fbir.cmc, sbir.cmc, marr.cmc, rural, educ, age, agec, partneredu, partnerage, weight, psu, strata)<span class="sc">%&gt;%</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agefb =</span> (age <span class="sc">-</span> (int.cmc <span class="sc">-</span> fbir.cmc)<span class="sc">/</span><span class="dv">12</span>))<span class="sc">%&gt;%</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">secbi =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sbir.cmc)<span class="sc">==</span>T,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                   int.cmc <span class="sc">-</span> fbir.cmc, </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                   fbir.cmc <span class="sc">-</span> sbir.cmc),</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">b2event =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sbir.cmc)<span class="sc">==</span>T,<span class="dv">0</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="create-the-person-period-file" class="level3">
<h3 class="anchored" data-anchor-id="create-the-person-period-file">Create the person-period file</h3>
<p>The distinction between the way we have been doing things and the discrete time model, is that we treat time discretely, versus continuously. This means that we transform the data from the case-duration data format to the person-period format. For this example, a natural choice would be year, since we have intervals of equal length (12 months each).</p>
<p>R provides a useful function called <code>survSplit()</code> in the <code>survival</code> library that will split a continuous duration into discrete periods.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: survival</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'survey'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    dotchart</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>pp<span class="ot">&lt;-</span><span class="fu">survSplit</span>(<span class="fu">Surv</span>(secbi, b2event)<span class="sc">~</span>. , </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> sub[sub<span class="sc">$</span>secbi<span class="sc">&gt;</span><span class="dv">0</span>,],</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">cut=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">240</span>, <span class="dv">12</span>), </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">episode=</span><span class="st">"year_birth"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>pp<span class="sc">$</span>year <span class="ot">&lt;-</span> pp<span class="sc">$</span>year_birth<span class="dv">-1</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>pp<span class="ot">&lt;-</span>pp[<span class="fu">order</span>(pp<span class="sc">$</span>CASEID, pp<span class="sc">$</span>year_birth),]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(pp[, <span class="fu">c</span>(<span class="st">"CASEID"</span>, <span class="st">"secbi"</span>, <span class="st">"b2event"</span>, <span class="st">"year"</span>, <span class="st">"educ"</span>, <span class="st">"agefb"</span>)], <span class="at">n=</span><span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">CASEID</th>
<th style="text-align: right;">secbi</th>
<th style="text-align: right;">b2event</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">educ</th>
<th style="text-align: right;">agefb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">96</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">120</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">132</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">156</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">168</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">180</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">192</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 13 2</td>
<td style="text-align: right;">196</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">24.66667</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 36 2</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">22.75000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1 36 2</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">22.75000</td>
</tr>
<tr class="even">
<td style="text-align: left;">1 36 2</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">22.75000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We see that each woman is not in the data for multiple “risk periods”, until they experience the event (birth) or are censored.</p>
</section>
<section id="discrete-time-model" class="level3">
<h3 class="anchored" data-anchor-id="discrete-time-model">Discrete time model</h3>
<p>So, the best thing about the discrete time model, is that it’s just logistic regression. Each risk period is treated as a single Bernoulli trial, and the birth can either occur (y=1) or not (y=0) in the period. This is how we get the hazard of the event, as the estimated probability of failure in each discrete time period. So, any method you would like to use to model this probability would probably work (logit, probit models), but I will show two standard approaches.</p>
<p>First, we will use the traditional logit link to the binomial distribution, then we will use the complementary log-log link. The latter is used because it preserves the proportional hazards property of the model, as in the Cox model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>des<span class="ot">&lt;-</span>survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">ids=</span><span class="sc">~</span>psu,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">strata=</span><span class="sc">~</span>strata,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>pp,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight=</span><span class="sc">~</span>weight )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the basic logistic model with ONLY time in the model</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#I do -1 so that no intercept is fit in the model, and we get a hazard estimate for each time period</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.0</span><span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span><span class="fu">as.factor</span>(year)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = b2event ~ as.factor(year) - 1, design = des, 
    family = binomial(link = "cloglog"))

Survey design:
survey::svydesign(ids = ~psu, strata = ~strata, data = pp, weight = ~weight)

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
as.factor(year)1  -4.73285    0.16969 -27.891  &lt; 2e-16 ***
as.factor(year)2  -2.59301    0.06627 -39.126  &lt; 2e-16 ***
as.factor(year)3  -2.05019    0.05698 -35.982  &lt; 2e-16 ***
as.factor(year)4  -1.94422    0.05018 -38.746  &lt; 2e-16 ***
as.factor(year)5  -1.85472    0.05608 -33.072  &lt; 2e-16 ***
as.factor(year)6  -1.77539    0.05706 -31.115  &lt; 2e-16 ***
as.factor(year)7  -1.69999    0.06850 -24.819  &lt; 2e-16 ***
as.factor(year)8  -2.00585    0.08490 -23.625  &lt; 2e-16 ***
as.factor(year)9  -2.00025    0.09480 -21.099  &lt; 2e-16 ***
as.factor(year)10 -2.06047    0.11273 -18.278  &lt; 2e-16 ***
as.factor(year)11 -1.96067    0.11481 -17.078  &lt; 2e-16 ***
as.factor(year)12 -2.15754    0.13221 -16.319  &lt; 2e-16 ***
as.factor(year)13 -2.23079    0.17452 -12.782  &lt; 2e-16 ***
as.factor(year)14 -2.26038    0.17878 -12.644  &lt; 2e-16 ***
as.factor(year)15 -2.33106    0.20768 -11.225  &lt; 2e-16 ***
as.factor(year)16 -2.41583    0.19583 -12.336  &lt; 2e-16 ***
as.factor(year)17 -2.65901    0.31435  -8.459  &lt; 2e-16 ***
as.factor(year)18 -2.78069    0.34502  -8.060 3.54e-15 ***
as.factor(year)19 -3.92030    0.47573  -8.241 9.06e-16 ***
as.factor(year)20 -2.98481    0.38224  -7.809 2.24e-14 ***
as.factor(year)21 -3.10096    0.51659  -6.003 3.18e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1.000026)

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the hazard function on the probability scale</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>haz<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(fit<span class="fl">.0</span>)))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>time<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">21</span>,<span class="dv">1</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(haz<span class="sc">~</span>time, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">ylab=</span><span class="st">"h(t)"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"Discrete Time Hazard Function for second birth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EX7_DiscreteTime_2_22_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="plot-the-survival-function-estimate" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-survival-function-estimate">Plot the survival function estimate</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>St<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>time<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(haz)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>St[<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">-</span>haz[<span class="dv">1</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(haz)){</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  St[i]<span class="ot">&lt;-</span>St[i<span class="dv">-1</span>]<span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>haz[i])</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>St<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span>, St)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>time<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>, time)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">y=</span>St,<span class="at">x=</span>time, <span class="at">type=</span><span class="st">"l"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Survival function for second birth interval"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EX7_DiscreteTime_2_22_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="alternative-time-specifications-1" class="level3">
<h3 class="anchored" data-anchor-id="alternative-time-specifications-1">Alternative time specifications</h3>
<p>Here, we can specify how we want time in our model. The general model fits a hazard at every time point. If you have a lot of time points, and especially if you have low numbers of events at some time points, this can be computationally expensive.</p>
<p>We can, however, specify time as a linear or quadratic term, and the model will not fit separate hazards at all times, instead, the baseline hazard will be a linear or curvilinear function of time.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Linear term for time</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.0</span><span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = b2event ~ 1, design = des, family = binomial(link = "cloglog"))

Survey design:
survey::svydesign(ids = ~psu, strata = ~strata, data = pp, weight = ~weight)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.22706    0.01918  -116.1   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1.000026)

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(fit<span class="fl">.0</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
 0.09734632 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Linear term for time</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fit.l<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span>year,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = b2event ~ year, design = des, family = binomial(link = "cloglog"))

Survey design:
survey::svydesign(ids = ~psu, strata = ~strata, data = pp, weight = ~weight)

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.416650   0.028047 -86.164  &lt; 2e-16 ***
year         0.033726   0.004761   7.084 3.47e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 0.9952062)

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>Which shows the hazard increases over time, which makes a lot of sense in the context of this outcome. Now we can consider quadratic terms for time and a natural spline function of time as well:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fit.s<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span>year<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = b2event ~ year + I(year^2), design = des, family = binomial(link = "cloglog"))

Survey design:
survey::svydesign(ids = ~psu, strata = ~strata, data = pp, weight = ~weight)

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -3.35596    0.06434  -52.16   &lt;2e-16 ***
year         0.38369    0.02195   17.48   &lt;2e-16 ***
I(year^2)   -0.02209    0.00149  -14.82   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1.009634)

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fit.c<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span>year<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">3</span> ),</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = b2event ~ year + I(year^2) + I(year^3), design = des, 
    family = binomial(link = "cloglog"))

Survey design:
survey::svydesign(ids = ~psu, strata = ~strata, data = pp, weight = ~weight)

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -4.1368559  0.0912631  -45.33   &lt;2e-16 ***
year         0.8285081  0.0401488   20.64   &lt;2e-16 ***
I(year^2)   -0.0843188  0.0048356  -17.44   &lt;2e-16 ***
I(year^3)    0.0023341  0.0001608   14.52   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 0.964793)

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fit.q<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span>year<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">3</span> )<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.q)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = b2event ~ year + I(year^2) + I(year^3) + I(year^4), 
    design = des, family = binomial(link = "cloglog"))

Survey design:
survey::svydesign(ids = ~psu, strata = ~strata, data = pp, weight = ~weight)

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -5.216e+00  1.431e-01 -36.444  &lt; 2e-16 ***
year         1.659e+00  1.006e-01  16.486  &lt; 2e-16 ***
I(year^2)   -2.680e-01  2.281e-02 -11.750  &lt; 2e-16 ***
I(year^3)    1.713e-02  1.943e-03   8.816  &lt; 2e-16 ***
I(year^4)   -3.835e-04  5.415e-05  -7.082 3.53e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 0.9679146)

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Spline</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>fit.sp<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span><span class="fu">ns</span>(year, <span class="at">df =</span> <span class="dv">3</span>),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">design=</span>des ,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.sp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
svyglm(formula = b2event ~ ns(year, df = 3), design = des, family = binomial(link = "cloglog"))

Survey design:
survey::svydesign(ids = ~psu, strata = ~strata, data = pp, weight = ~weight)

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)       -3.82491    0.07575 -50.492  &lt; 2e-16 ***
ns(year, df = 3)1  0.95545    0.11930   8.009 4.97e-15 ***
ns(year, df = 3)2  3.18995    0.16248  19.633  &lt; 2e-16 ***
ns(year, df = 3)3 -0.16044    0.15785  -1.016     0.31    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 0.9607684)

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>Now, let’s look at the hazards:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">expand.grid</span>(<span class="at">year=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">20</span>,<span class="dv">1</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>genmod<span class="ot">&lt;-</span><span class="fu">predict</span>(fit<span class="fl">.0</span>, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">year=</span><span class="fu">as.factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> )), <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>lin<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.l, <span class="at">newdata=</span>dat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>sq<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.s, <span class="at">newdata=</span>dat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>cub<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.c, <span class="at">newdata=</span>dat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>quart<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.q, <span class="at">newdata=</span>dat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>spline<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.sp, <span class="at">newdata=</span><span class="fu">expand.grid</span>(<span class="at">year=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">20</span>,<span class="dv">1</span>)), <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["genmod"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lin"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["sq"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["cub"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["quart"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["spline"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.1022329","3":"0.08815054","4":"0.04883565","5":"0.03313604","6":"0.02193840","7":"0.02158409"},{"1":"2","2":"0.1022329","3":"0.09103227","4":"0.06646075","5":"0.05908727","6":"0.05678264","7":"0.03066431"},{"1":"3","2":"0.1022329","3":"0.09400326","4":"0.08641637","5":"0.09120755","6":"0.10291220","7":"0.04298980"},{"1":"4","2":"0.1022329","3":"0.09706594","4":"0.10742423","5":"0.12393847","6":"0.14275615","7":"0.05878068"},{"1":"5","2":"0.1022329","3":"0.10022279","4":"0.12778480","5":"0.15089228","6":"0.16388223","7":"0.07750134"},{"1":"6","2":"0.1022329","3":"0.10347630","4":"0.14561261","5":"0.16740835","6":"0.16570870","7":"0.09748243"},{"1":"7","2":"0.1022329","3":"0.10682904","4":"0.15912493","5":"0.17185330","6":"0.15489811","7":"0.11581018"},{"1":"8","2":"0.1022329","3":"0.11028360","4":"0.16691445","5":"0.16543487","6":"0.13909384","7":"0.12887238"},{"1":"9","2":"0.1022329","3":"0.11384259","4":"0.16815444","5":"0.15116988","6":"0.12371293","7":"0.13492314"},{"1":"10","2":"0.1022329","3":"0.11750868","4":"0.16271246","5":"0.13267571","6":"0.11152262","7":"0.13449755"},{"1":"11","2":"0.1022329","3":"0.12128457","4":"0.15116809","5":"0.11320260","6":"0.10342332","7":"0.12912848"},{"1":"12","2":"0.1022329","3":"0.12517297","4":"0.13473441","5":"0.09509968","6":"0.09928661","7":"0.12074750"},{"1":"13","2":"0.1022329","3":"0.12917666","4":"0.11508504","5":"0.07971626","6":"0.09840487","7":"0.11121754"},{"1":"14","2":"0.1022329","3":"0.13329839","4":"0.09410183","5":"0.06759968","6":"0.09953025","7":"0.10206049"},{"1":"15","2":"0.1022329","3":"0.13754099","4":"0.07358435","5":"0.05881197","6":"0.10065714","7":"0.09396874"},{"1":"16","2":"0.1022329","3":"0.14190726","4":"0.05498699","5":"0.05323979","6":"0.09886525","7":"0.08680359"},{"1":"17","2":"0.1022329","3":"0.14640005","4":"0.03924959","5":"0.05085754","6":"0.09078436","7":"0.08039563"},{"1":"18","2":"0.1022329","3":"0.15102220","4":"0.02675798","5":"0.05198023","6":"0.07428135","7":"0.07460558"},{"1":"19","2":"0.1022329","3":"0.15577656","4":"0.01742441","5":"0.05761491","6":"0.05103379","7":"0.06931880"},{"1":"20","2":"0.1022329","3":"0.16066599","4":"0.01084067","5":"0.07013976","6":"0.02742312","7":"0.06444111"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(genmod<span class="sc">~</span>year, dat, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">ylab=</span><span class="st">"h(t)"</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">25</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"Hazard function from different time parameterizations"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(lin<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sq<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(cub<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">4</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(quart<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">5</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(spline<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">6</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"General Model"</span>, <span class="st">"Linear"</span>,<span class="st">"Square"</span>, <span class="st">"Cubic"</span>, <span class="st">"Quartic"</span>, <span class="st">"Natural spline"</span>),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EX7_DiscreteTime_2_22_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="864"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#AIC table</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>aic<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">c</span>(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  fit.l<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.l<span class="sc">$</span>coefficients),</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  fit.s<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.s<span class="sc">$</span>coefficients),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  fit.c<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.c<span class="sc">$</span>coefficients),</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  fit.q<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.q<span class="sc">$</span>coefficients),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  fit.sp<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.sp<span class="sc">$</span>coefficients),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  fit<span class="fl">.0</span><span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit<span class="fl">.0</span><span class="sc">$</span>coefficients)),<span class="dv">2</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#compare all aics to the one from the general model</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>dif.aic<span class="ot">&lt;-</span><span class="fu">round</span>(aic<span class="sc">-</span>aic[<span class="dv">6</span>],<span class="dv">2</span>)</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">model =</span><span class="fu">c</span>( <span class="st">"linear"</span>,<span class="st">"square"</span>, <span class="st">"cubic"</span>, <span class="st">"quartic"</span>,<span class="st">"spline"</span>, <span class="st">"general"</span>),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">aic=</span>aic,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">aic_dif=</span>dif.aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["model"],"name":[1],"type":["chr"],"align":["left"]},{"label":["aic"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["aic_dif"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"linear","2":"25090.01","3":"-90.04"},{"1":"square","2":"24386.34","3":"-793.71"},{"1":"cubic","2":"24158.01","3":"-1022.04"},{"1":"quartic","2":"24010.14","3":"-1169.91"},{"1":"spline","2":"24002.84","3":"-1177.21"},{"1":"general","2":"25180.05","3":"0.00"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>So the general model, quartic and spline give the same AIC points, but the square and cubic models also fit equally as well.</p>
</section>
</section>
<section id="ipums-nhis-mortality-example" class="level2">
<h2 class="anchored" data-anchor-id="ipums-nhis-mortality-example">IPUMS NHIS Mortality example</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">"C:/Users/ozd504/OneDrive - University of Texas at San Antonio/classes/dem7223/dem7223_22//data/nhis_00012.dta"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "year"         "serial"       "strata"       "psu"          "nhishid"     
 [6] "hhweight"     "region"       "pernum"       "nhispid"      "hhx"         
[11] "fmx"          "px"           "perweight"    "sampweight"   "fweight"     
[16] "supp2wt"      "intervwyr"    "astatflg"     "cstatflg"     "telephone"   
[21] "age"          "sex"          "marstat"      "marst"        "marstcohab"  
[26] "cohabmarst"   "cohabevmar"   "birthyr"      "relate"       "famsize"     
[31] "momed"        "racea"        "hispeth"      "yrsinus"      "hispyn"      
[36] "usborn"       "citizen"      "racenew"      "educrec2"     "empstat"     
[41] "pooryn"       "incfamr82on"  "gotnewelf"    "gotssiwhy"    "gotnonssdis" 
[46] "gotdiv"       "gotchsup"     "gotstamp"     "poverty"      "poverty2"    
[51] "ownership"    "lowrent"      "health"       "height"       "weight"      
[56] "bmicalc"      "bmi"          "bedayr"       "hstatyr"      "wldayr"      
[61] "usualpl"      "typplsick"    "routcare"     "delaycost"    "famdelaycono"
[66] "famdelaycost" "famybarcar"   "famybarcarno" "placecar"     "delayappt"   
[71] "delayhrs"     "delayphone"   "delaytrans"   "delaywait"    "ybarcare"    
[76] "ybardental"   "ybarglass"    "ybarmeds"     "ybarmental"   "alc5upyr"    
[81] "smokev"       "smokagereg"   "mortelig"     "mortstat"     "mortdody"    
[86] "mortucodld"   "mortwt"       "mortcms"      "mortndi"      "mortssa"     
[91] "mortwtsa"    </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>sub<span class="ot">&lt;-</span><span class="fu">subset</span>(dat, dat<span class="sc">$</span>mortelig<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span><span class="fu">is.na</span>(dat<span class="sc">$</span>racenew)<span class="sc">==</span>F)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>samps<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sub<span class="sc">$</span>year), <span class="at">size =</span> <span class="dv">100000</span>, <span class="at">replace =</span> F)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>sub<span class="ot">&lt;-</span>sub[samps,]</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>sub<span class="ot">&lt;-</span><span class="fu">zap_labels</span>(sub)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="alternative-codings-of-failure-time" class="level3">
<h3 class="anchored" data-anchor-id="alternative-codings-of-failure-time">alternative codings of failure time</h3>
<p>In mortality analysis, but in any type of case-duration data, we can construct our event indicator to represent if an event occurs during a set risk period. In the NHIS mortality, we could code the death as a few different ways:</p>
<p>If you are interested in the <em>Age at death</em>, then you will measure your outcome as the age when they died</p>
<p>Coding age at death. If the person died, then it is equal to the year the person died, minus the year in which they were born. If the person was still alive, then it is the difference between 2009 (year of follow up in this data file)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>d.age<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">1</span>,sub<span class="sc">$</span>mortdody<span class="sc">-</span>(sub<span class="sc">$</span>year<span class="sc">-</span>sub<span class="sc">$</span>age) ,</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">2</span>,<span class="dv">2009</span><span class="sc">-</span>(sub<span class="sc">$</span>year<span class="sc">-</span>sub<span class="sc">$</span>age), <span class="cn">NA</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If you are interested in the risk of death in a follow up period, then you could code it as: - Did the person die in the follow up period at all? No time specified - Did the person die in a 1, 5, or 10 year period? This specifies a fixed risk period</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>d.event<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="co">#did they die?</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>timetodeath<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>mortstat <span class="sc">==</span><span class="dv">1</span>, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                        sub<span class="sc">$</span>mortdody<span class="sc">-</span>sub<span class="sc">$</span>year  ,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">2009</span> <span class="sc">-</span> sub<span class="sc">$</span>year ) <span class="co">#how long after the interview did they die?</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>d1yr<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>timetodeath<span class="sc">&lt;=</span><span class="dv">1</span><span class="sc">&amp;</span>sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>) <span class="co">#did they die within 1 year of the interview</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>d5yr<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>timetodeath<span class="sc">&lt;=</span><span class="dv">5</span><span class="sc">&amp;</span>sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>) <span class="co">#did they die within 5 years of the interview</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Other variables</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>married<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>marstat,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">recodes=</span><span class="st">"00=NA; 10:13='married'; 20:40='sep'; 50='nm'; 99=NA"</span> ,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">as.factor=</span>T )</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>male<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>sex<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>mwt<span class="ot">&lt;-</span>sub<span class="sc">$</span>mortwt<span class="sc">/</span><span class="fu">mean</span>(sub<span class="sc">$</span>mortwt, <span class="at">na.rm=</span>T)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>age5<span class="ot">&lt;-</span><span class="fu">cut</span>(sub<span class="sc">$</span>age,<span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">85</span>, <span class="dv">5</span>))</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>racenew,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">recodes =</span><span class="st">"10='wht'; 20 ='blk'; 30:61='other'; 97:99=NA"</span>,</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">as.factor=</span>T)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>college<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>educrec2,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">recodes=</span><span class="st">"00=NA; 10:42='hs or less'; 50:53='some coll'; 54:60='coll'; else=NA"</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">as.factor=</span>T)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>black<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">'blk'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>oth<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">'other'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>hs<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>college<span class="sc">==</span><span class="st">'hs or less'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>col1<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>college<span class="sc">==</span><span class="st">'some coll'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>sep<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>married<span class="sc">==</span><span class="st">'sep'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>nm<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>married<span class="sc">==</span><span class="st">'nm'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>racenew, <span class="at">recodes =</span><span class="st">"10='wht'; 20 ='blk'; 30:61='other'; 97:99=NA"</span>, <span class="at">as.factor=</span>T)</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>hisp<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>hispyn, <span class="at">recodes=</span><span class="st">"1=0; 2=1; else=NA"</span>)</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[sub<span class="sc">$</span>hisp <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">"wht"</span>]<span class="ot">&lt;-</span><span class="st">"NHWhite"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Unknown or uninitialised column: `race_eth`.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[sub<span class="sc">$</span>hisp <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">"blk"</span>]<span class="ot">&lt;-</span><span class="st">"NHBlack"</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[sub<span class="sc">$</span>hisp <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">"other"</span>]<span class="ot">&lt;-</span><span class="st">"NHother"</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[sub<span class="sc">$</span>hisp <span class="sc">==</span> <span class="dv">1</span> ]<span class="ot">&lt;-</span><span class="st">"Hispanic"</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[<span class="fu">is.na</span>(sub<span class="sc">$</span>hisp) <span class="sc">==</span>T <span class="sc">|</span> <span class="fu">is.na</span>(sub<span class="sc">$</span>race)<span class="sc">==</span>T]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth<span class="ot">&lt;-</span><span class="fu">fct_relevel</span>(sub<span class="sc">$</span>race_eth, <span class="fu">c</span>(<span class="st">"NHWhite"</span>, <span class="st">"NHBlack"</span> , <span class="st">"Hispanic"</span>, <span class="st">"NHother"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="create-person---period-file" class="level3">
<h3 class="anchored" data-anchor-id="create-person---period-file">Create person - period file</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>subpp<span class="ot">&lt;-</span><span class="fu">survSplit</span>(<span class="fu">Surv</span>(d.age, d.event)<span class="sc">~</span>., <span class="at">data=</span>sub,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="at">cut=</span><span class="fu">seq</span>(<span class="dv">18</span>, <span class="dv">100</span>, <span class="dv">5</span>),  <span class="at">episode=</span><span class="st">"mort_5_yr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Analysis of death outcome</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>des2<span class="ot">&lt;-</span><span class="fu">svydesign</span>(<span class="at">ids=</span><span class="sc">~</span>psu, <span class="at">strata=</span><span class="sc">~</span>strata,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">weights =</span> <span class="sc">~</span>perweight, <span class="at">data=</span>subpp, <span class="at">nest=</span>T)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="co"># constant model</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span> race_eth<span class="sc">+</span>college,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">design=</span>des2, <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#general model</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span><span class="fu">factor</span>(mort_5_yr) <span class="sc">+</span> race_eth<span class="sc">+</span>college,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">design=</span>des2, <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#linear model</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span>mort_5_yr<span class="sc">+</span>race_eth<span class="sc">+</span>college, <span class="at">design=</span>des2,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#quadratic model</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span>mort_5_yr<span class="sc">+</span> <span class="fu">I</span>(mort_5_yr<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>race_eth<span class="sc">+</span>college,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">design=</span>des2, <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#spline model</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span><span class="fu">ns</span>(mort_5_yr, <span class="at">df=</span><span class="dv">3</span>)<span class="sc">+</span>race_eth<span class="sc">+</span>college, <span class="at">design=</span>des2,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
</div>
</section>
</section>
<section id="generate-hazard-plots" class="level2">
<h2 class="anchored" data-anchor-id="generate-hazard-plots">Generate hazard plots</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>newdat<span class="ot">&lt;-</span><span class="fu">expand.grid</span>(<span class="at">mort_5_yr =</span> <span class="fu">unique</span>(subpp<span class="sc">$</span>mort_5_yr), </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">race_eth=</span> <span class="fu">unique</span>(subpp<span class="sc">$</span>race_eth), </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">college =</span> <span class="fu">unique</span>(subpp<span class="sc">$</span>college))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>newdat<span class="ot">&lt;-</span>newdat<span class="sc">%&gt;%</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">complete.cases</span>(.))</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h0<span class="ot">&lt;-</span><span class="fu">predict</span>(m0, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h1<span class="ot">&lt;-</span><span class="fu">predict</span>(m1, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h2<span class="ot">&lt;-</span><span class="fu">predict</span>(m2, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h3<span class="ot">&lt;-</span><span class="fu">predict</span>(m3, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h4<span class="ot">&lt;-</span><span class="fu">predict</span>(m4, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(newdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["mort_5_yr"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["race_eth"],"name":[2],"type":["fct"],"align":["left"]},{"label":["college"],"name":[3],"type":["fct"],"align":["left"]},{"label":["h0"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["h1"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["h2"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["h3"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["h4"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"NHWhite","3":"hs or less","4":"0.0213697","5":"8.794238e-06","6":"0.0001678870","7":"0.0005602979","8":"7.948138e-05","_rn_":"1"},{"1":"2","2":"NHWhite","3":"hs or less","4":"0.0213697","5":"4.410104e-04","6":"0.0002949060","7":"0.0007509939","8":"1.274667e-04","_rn_":"2"},{"1":"3","2":"NHWhite","3":"hs or less","4":"0.0213697","5":"1.057388e-03","6":"0.0005179994","7":"0.0010366749","8":"2.027609e-04","_rn_":"3"},{"1":"4","2":"NHWhite","3":"hs or less","4":"0.0213697","5":"1.754403e-03","6":"0.0009097839","7":"0.0014737550","8":"3.173129e-04","_rn_":"4"},{"1":"5","2":"NHWhite","3":"hs or less","4":"0.0213697","5":"2.271262e-03","6":"0.0015976544","7":"0.0021575643","8":"4.845815e-04","_rn_":"5"},{"1":"6","2":"NHWhite","3":"hs or less","4":"0.0213697","5":"3.270390e-03","6":"0.0028048803","7":"0.0032525355","8":"7.162772e-04","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    between, first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'magrittr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    set_names</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>out<span class="ot">&lt;-</span><span class="fu">melt</span>(<span class="fu">setDT</span>(newdat),</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"mort_5_yr"</span>, <span class="st">"race_eth"</span>, <span class="st">"college"</span>),</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure.vars =</span> <span class="fu">list</span>(<span class="at">haz=</span><span class="fu">c</span>(<span class="st">"h0"</span>, <span class="st">"h1"</span>,<span class="st">"h2"</span>,<span class="st">"h3"</span>, <span class="st">"h4"</span>)))</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out, <span class="at">n=</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["mort_5_yr"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["race_eth"],"name":[2],"type":["fct"],"align":["left"]},{"label":["college"],"name":[3],"type":["fct"],"align":["left"]},{"label":["variable"],"name":[4],"type":["fct"],"align":["left"]},{"label":["value"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"2","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"3","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"4","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"5","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"6","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"7","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"8","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"9","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"10","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"11","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"12","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"13","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"14","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"15","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"16","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"17","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"18","2":"NHWhite","3":"hs or less","4":"h0","5":"0.02136970"},{"1":"1","2":"Hispanic","3":"hs or less","4":"h0","5":"0.01390992"},{"1":"2","2":"Hispanic","3":"hs or less","4":"h0","5":"0.01390992"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>out<span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(college <span class="sc">==</span> <span class="st">"coll"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(.<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h0"</span> <span class="sc">~</span> <span class="st">"Constant"</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h1"</span> <span class="sc">~</span> <span class="st">"General"</span>,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h2"</span> <span class="sc">~</span> <span class="st">"Linear"</span>,</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h3"</span> <span class="sc">~</span> <span class="st">"Polynomial - 2"</span>,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h4"</span> <span class="sc">~</span> <span class="st">"Spline"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mort_5_yr<span class="sc">*</span><span class="dv">5</span>, <span class="at">y=</span>value ))<span class="sc">+</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>race_eth, <span class="at">color=</span>race_eth) )<span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hazard function for adult mortality"</span>, </span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Alternative model specifications"</span>)<span class="sc">+</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"S(t)"</span>)<span class="sc">+</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mod)<span class="co">#+ scale_y_continuous(trans = "log10")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Don't know how to automatically pick scale for object of type svystat. Defaulting to continuous.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EX7_DiscreteTime_2_22_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="model-fits" class="level3">
<h3 class="anchored" data-anchor-id="model-fits">Model fits</h3>
<p>Here we construct a table of the relative model fits for the five different time specifications</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>AIC0<span class="ot">&lt;-</span><span class="fu">AIC</span>(m0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>AIC1<span class="ot">&lt;-</span><span class="fu">AIC</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>AIC2<span class="ot">&lt;-</span><span class="fu">AIC</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>AIC3<span class="ot">&lt;-</span><span class="fu">AIC</span>(m3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>AIC4<span class="ot">&lt;-</span><span class="fu">AIC</span>(m4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>AICS<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">AIC =</span> <span class="fu">c</span>(AIC0[<span class="st">"AIC"</span>],AIC1[<span class="st">"AIC"</span>],AIC2[<span class="st">"AIC"</span>],AIC3[<span class="st">"AIC"</span>],AIC4[<span class="st">"AIC"</span>]),</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mod =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"const"</span>, <span class="st">"general"</span>, <span class="st">"linear"</span>, <span class="st">"poly 2"</span>, <span class="st">"spline"</span>)) )</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>AICS<span class="sc">$</span>mod<span class="ot">&lt;-</span>forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(AICS<span class="sc">$</span>mod,</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="st">"general"</span>, <span class="st">"const"</span> , <span class="st">"linear"</span>, <span class="st">"poly2"</span>, <span class="st">"spline"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 1 unknown level in `f`: poly2</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>AICS<span class="sc">$</span>deltaAIC<span class="ot">&lt;-</span>AICS<span class="sc">$</span>AIC <span class="sc">-</span> AICS<span class="sc">$</span>AIC[AICS<span class="sc">$</span>mod<span class="sc">==</span><span class="st">"general"</span>]</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(AICS[, <span class="fu">c</span>(<span class="st">"mod"</span>, <span class="st">"AIC"</span>, <span class="st">"deltaAIC"</span>)],</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">"Relative AIC for alternative time specifications"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<caption>Relative AIC for alternative time specifications</caption>
<thead>
<tr class="header">
<th style="text-align: left;">mod</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">deltaAIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">const</td>
<td style="text-align: right;">120065.72</td>
<td style="text-align: right;">44053.9627</td>
</tr>
<tr class="even">
<td style="text-align: left;">general</td>
<td style="text-align: right;">76011.76</td>
<td style="text-align: right;">0.0000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">linear</td>
<td style="text-align: right;">76796.07</td>
<td style="text-align: right;">784.3164</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly 2</td>
<td style="text-align: right;">76393.29</td>
<td style="text-align: right;">381.5333</td>
</tr>
<tr class="odd">
<td style="text-align: left;">spline</td>
<td style="text-align: right;">76295.13</td>
<td style="text-align: right;">283.3733</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>We see that nothing touches the AIC for the general model in this case.</p>
<!-- -->

</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb99" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "DEM 7223 - Event History Analysis -  Discrete Time Hazard Model 2"</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co">- name: '[Corey S. Sparks, PhD](https://coreysparks.github.io)'</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="co">  affiliation: '[The University of Texas at San Antonio](https://hcap.utsa.edu/demography)'</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%d %B, %Y')`"</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="co">    html:</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="co">      self-contained: true</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="co">      code-fold: true</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="co">      code-tools: true</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a><span class="co">      code-link: true</span></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="co">      df-print: paged</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a><span class="co">      toc: true</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a><span class="fu"># Notes</span></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>As we saw last week, when we fit the discrete time hazards model to the person-period data, we fit the model:</span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>$$logit(h(t))=\alpha_j+x'\beta$$</span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>Where the $\alpha_j$'s represent the logit-hazard for the distinct risk periods, and the $\beta$'s represent the effects of covariates on the hazard.</span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>This formulation is called the “general” form because it allows the shape of the hazard function to vary at each time point, as defined by the $\alpha_j$'s!  </span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>This allows great flexibility in modeling the changing nature of risk</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>This model specification by definition sets no constraints on the shape of the baseline function because we estimate the hazard at every time point.</span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>This specification is:</span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Easily interpretable in multiple scales</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Informative about the shape of the hazard function</span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Consistent with estimates from life tables</span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>If we include no predictors, we basically estimate the life table $q(x)$</span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a><span class="fu">### Alternative time specifications</span></span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a>We can specify alternative ways of modeling the hazard function</span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a>Instead of having one  $\alpha_j$ for each time point, we may be able to capture the shape of the hazard with fewer parameters.</span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a>Because the general model is not parsimonious, the estimates of the baseline hazard can fluctuate dramatically from time to time owing solely to sampling variation</span>
<span id="cb99-46"><a href="#cb99-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-47"><a href="#cb99-47" aria-hidden="true" tabindex="-1"></a>Also, if there are not many failures at particular times, we can have low certainty about the parameter estimate</span>
<span id="cb99-48"><a href="#cb99-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-49"><a href="#cb99-49" aria-hidden="true" tabindex="-1"></a>Although time in the general model is treated discretely, we can specify continuous time models as well by specifying time as a continuous, rather than a categorical predictor in our model </span>
<span id="cb99-50"><a href="#cb99-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-51"><a href="#cb99-51" aria-hidden="true" tabindex="-1"></a>This is done by assuming time is either: </span>
<span id="cb99-52"><a href="#cb99-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-53"><a href="#cb99-53" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Constant – hazard is constant at all time, time is not in the model at all</span>
<span id="cb99-54"><a href="#cb99-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-55"><a href="#cb99-55" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Linear – hazard increases/decreases with time</span>
<span id="cb99-56"><a href="#cb99-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-57"><a href="#cb99-57" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Quadratic – hazard is a nonlinear curve over time with 1 inflection point</span>
<span id="cb99-58"><a href="#cb99-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-59"><a href="#cb99-59" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Cubic – hazard is nonlinear over time with 2 inflection points</span>
<span id="cb99-60"><a href="#cb99-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-61"><a href="#cb99-61" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Higher order – hazard is nonlinear over time with &gt;2 inflection points</span>
<span id="cb99-62"><a href="#cb99-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-63"><a href="#cb99-63" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Spline basis – nonlinear but not specifically using polynomials</span>
<span id="cb99-64"><a href="#cb99-64" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb99-65"><a href="#cb99-65" aria-hidden="true" tabindex="-1"></a>Each of these models specifies a more parsimonious version of the general form, with fewer parameters, *if the number of time points is large* </span>
<span id="cb99-66"><a href="#cb99-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-67"><a href="#cb99-67" aria-hidden="true" tabindex="-1"></a>But, they will never fit the data as well as the general model</span>
<span id="cb99-68"><a href="#cb99-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-69"><a href="#cb99-69" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing model fit for different time specifications</span></span>
<span id="cb99-70"><a href="#cb99-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-71"><a href="#cb99-71" aria-hidden="true" tabindex="-1"></a>To compare discrete time models we use standard model comparison methods</span>
<span id="cb99-72"><a href="#cb99-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-73"><a href="#cb99-73" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Model Deviance = (-2*log likelihood)</span>
<span id="cb99-74"><a href="#cb99-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-75"><a href="#cb99-75" aria-hidden="true" tabindex="-1"></a><span class="ss"> * </span>Model AIC = (-2 log likelihood + 2*(p+1))</span>
<span id="cb99-76"><a href="#cb99-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-77"><a href="#cb99-77" aria-hidden="true" tabindex="-1"></a>For example, if we fit the constant hazard, the linear hazard, a cubic hazard and a quartic hazard, we compare the performance of each model to the performance of the general model (with 1 parameter for each time point)</span>
<span id="cb99-78"><a href="#cb99-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-79"><a href="#cb99-79" aria-hidden="true" tabindex="-1"></a>We get:</span>
<span id="cb99-80"><a href="#cb99-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-81"><a href="#cb99-81" aria-hidden="true" tabindex="-1"></a><span class="al">![AIC Table](C:/Users/ozd504/Documents/Github/DEM7223/images/aictab.png)</span></span>
<span id="cb99-82"><a href="#cb99-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-83"><a href="#cb99-83" aria-hidden="true" tabindex="-1"></a>We see the General model is the best fitting, but the quartic model is the next best.</span>
<span id="cb99-84"><a href="#cb99-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-85"><a href="#cb99-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-86"><a href="#cb99-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Constructing Survival Curves for the discrete time model</span></span>
<span id="cb99-87"><a href="#cb99-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-88"><a href="#cb99-88" aria-hidden="true" tabindex="-1"></a>We have seen how to plot the hazard function for the discrete time model, but we can also plot the survival function estimates as well. </span>
<span id="cb99-89"><a href="#cb99-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-90"><a href="#cb99-90" aria-hidden="true" tabindex="-1"></a>If we use the product-limit estimator, then we can estimate survival to time t as:</span>
<span id="cb99-91"><a href="#cb99-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-92"><a href="#cb99-92" aria-hidden="true" tabindex="-1"></a>$$S(t) = S_{t-1} * (1-h_t)$$</span>
<span id="cb99-93"><a href="#cb99-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-94"><a href="#cb99-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-95"><a href="#cb99-95" aria-hidden="true" tabindex="-1"></a><span class="fu"># Examples</span></span>
<span id="cb99-96"><a href="#cb99-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-97"><a href="#cb99-97" aria-hidden="true" tabindex="-1"></a>This example will illustrate how to fit the discrete time hazard model to person-period data. Specifically, this example illustrates various parameterizartions of time in the discrete time model. In this example, I will use the event of a couple having a second birth. The data for this example come from the data <span class="co">[</span><span class="ot">Demographic and Health Survey for 2012</span><span class="co">](http://www.dhsprogram.com/data/model-datasets.cfm)</span> children's recode file. This file contains information for all births in the last 5 years prior to the survey.</span>
<span id="cb99-98"><a href="#cb99-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-99"><a href="#cb99-99" aria-hidden="true" tabindex="-1"></a>The second example will use data from the <span class="co">[</span><span class="ot">IPUMS NHIS</span><span class="co">](https://nhis.ipums.org/nhis/)</span> and examine alternative methods for coding time between survey and mortality follow up.</span>
<span id="cb99-100"><a href="#cb99-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-101"><a href="#cb99-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-102"><a href="#cb99-102" aria-hidden="true" tabindex="-1"></a><span class="fu"># Continuous duration outcome - DHS data</span></span>
<span id="cb99-103"><a href="#cb99-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-104"><a href="#cb99-104" aria-hidden="true" tabindex="-1"></a><span class="fu">### load the data</span></span>
<span id="cb99-105"><a href="#cb99-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-108"><a href="#cb99-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-109"><a href="#cb99-109" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb99-110"><a href="#cb99-110" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb99-111"><a href="#cb99-111" aria-hidden="true" tabindex="-1"></a><span class="co">#load the data</span></span>
<span id="cb99-112"><a href="#cb99-112" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">read_dta</span>(<span class="st">"../data/ZAIR71FL.DTA"</span>)</span>
<span id="cb99-113"><a href="#cb99-113" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">zap_labels</span>(dat)</span>
<span id="cb99-114"><a href="#cb99-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-115"><a href="#cb99-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-116"><a href="#cb99-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-117"><a href="#cb99-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-118"><a href="#cb99-118" aria-hidden="true" tabindex="-1"></a><span class="fu">## Event - Second birth occurrence</span></span>
<span id="cb99-119"><a href="#cb99-119" aria-hidden="true" tabindex="-1"></a>In the DHS individual recode file, information on every live birth is collected using a retrospective birth history survey mechanism.  </span>
<span id="cb99-120"><a href="#cb99-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-121"><a href="#cb99-121" aria-hidden="true" tabindex="-1"></a>Since our outcome is time between first and second birth, we must select as our risk set, only women who have had a first birth. </span>
<span id="cb99-122"><a href="#cb99-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-123"><a href="#cb99-123" aria-hidden="true" tabindex="-1"></a>The <span class="in">`bidx`</span> variable indexes the birth history and if <span class="in">`bidx_01`</span> is not missing, then the woman should be at risk of having a second birth (i.e. she has had a first birth, i.e. <span class="in">`bidx_01==1`</span>). </span>
<span id="cb99-124"><a href="#cb99-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-125"><a href="#cb99-125" aria-hidden="true" tabindex="-1"></a>I also select only non-twin births (<span class="in">`b0 == 0`</span>). </span>
<span id="cb99-126"><a href="#cb99-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-127"><a href="#cb99-127" aria-hidden="true" tabindex="-1"></a>The DHS provides the dates of when each child was born in Century Month Codes. </span>
<span id="cb99-128"><a href="#cb99-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-129"><a href="#cb99-129" aria-hidden="true" tabindex="-1"></a>To get the interval for women who *actually had* a second birth, that is the difference between the CMC for the first birth <span class="in">`b3_01`</span> and the second birth <span class="in">`b3_02`</span>, but for women who had not had a second birth by the time of the interview, the censored time between births is the difference between <span class="in">`b3_01`</span> and <span class="in">`v008`</span>, the date of the interview.</span>
<span id="cb99-130"><a href="#cb99-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-131"><a href="#cb99-131" aria-hidden="true" tabindex="-1"></a>We have <span class="in">`r as.numeric(table(is.na(dat$bidx_01))[1])`</span> women who are at risk of a second birth.</span>
<span id="cb99-132"><a href="#cb99-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-133"><a href="#cb99-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract_data}</span></span>
<span id="cb99-134"><a href="#cb99-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-135"><a href="#cb99-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-136"><a href="#cb99-136" aria-hidden="true" tabindex="-1"></a>sub<span class="ot">&lt;-</span>dat <span class="sc">%&gt;%</span></span>
<span id="cb99-137"><a href="#cb99-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bidx_01<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span>b0_01<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb99-138"><a href="#cb99-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">CASEID=</span>caseid, </span>
<span id="cb99-139"><a href="#cb99-139" aria-hidden="true" tabindex="-1"></a>                 <span class="at">int.cmc=</span>v008,</span>
<span id="cb99-140"><a href="#cb99-140" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fbir.cmc=</span>b3_01,</span>
<span id="cb99-141"><a href="#cb99-141" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sbir.cmc=</span>b3_02,</span>
<span id="cb99-142"><a href="#cb99-142" aria-hidden="true" tabindex="-1"></a>                 <span class="at">marr.cmc=</span>v509,</span>
<span id="cb99-143"><a href="#cb99-143" aria-hidden="true" tabindex="-1"></a>                 <span class="at">rural=</span>v025,</span>
<span id="cb99-144"><a href="#cb99-144" aria-hidden="true" tabindex="-1"></a>                 <span class="at">educ=</span>v106,</span>
<span id="cb99-145"><a href="#cb99-145" aria-hidden="true" tabindex="-1"></a>                 <span class="at">age =</span> v012,</span>
<span id="cb99-146"><a href="#cb99-146" aria-hidden="true" tabindex="-1"></a>                 <span class="at">agec=</span><span class="fu">cut</span>(v012, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">50</span>,<span class="dv">5</span>), <span class="at">include.lowest=</span>T),</span>
<span id="cb99-147"><a href="#cb99-147" aria-hidden="true" tabindex="-1"></a>                 <span class="at">partneredu=</span>v701,</span>
<span id="cb99-148"><a href="#cb99-148" aria-hidden="true" tabindex="-1"></a>                 <span class="at">partnerage=</span>v730,</span>
<span id="cb99-149"><a href="#cb99-149" aria-hidden="true" tabindex="-1"></a>                 <span class="at">weight=</span>v005<span class="sc">/</span><span class="dv">1000000</span>,</span>
<span id="cb99-150"><a href="#cb99-150" aria-hidden="true" tabindex="-1"></a>                 <span class="at">psu=</span>v021,</span>
<span id="cb99-151"><a href="#cb99-151" aria-hidden="true" tabindex="-1"></a>                 <span class="at">strata=</span>v022)<span class="sc">%&gt;%</span></span>
<span id="cb99-152"><a href="#cb99-152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CASEID, int.cmc, fbir.cmc, sbir.cmc, marr.cmc, rural, educ, age, agec, partneredu, partnerage, weight, psu, strata)<span class="sc">%&gt;%</span></span>
<span id="cb99-153"><a href="#cb99-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">agefb =</span> (age <span class="sc">-</span> (int.cmc <span class="sc">-</span> fbir.cmc)<span class="sc">/</span><span class="dv">12</span>))<span class="sc">%&gt;%</span></span>
<span id="cb99-154"><a href="#cb99-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">secbi =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sbir.cmc)<span class="sc">==</span>T,</span>
<span id="cb99-155"><a href="#cb99-155" aria-hidden="true" tabindex="-1"></a>                   int.cmc <span class="sc">-</span> fbir.cmc, </span>
<span id="cb99-156"><a href="#cb99-156" aria-hidden="true" tabindex="-1"></a>                   fbir.cmc <span class="sc">-</span> sbir.cmc),</span>
<span id="cb99-157"><a href="#cb99-157" aria-hidden="true" tabindex="-1"></a>         <span class="at">b2event =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(sbir.cmc)<span class="sc">==</span>T,<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb99-158"><a href="#cb99-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-159"><a href="#cb99-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-160"><a href="#cb99-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-161"><a href="#cb99-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-162"><a href="#cb99-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-163"><a href="#cb99-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-164"><a href="#cb99-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-165"><a href="#cb99-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-166"><a href="#cb99-166" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create the person-period file</span></span>
<span id="cb99-167"><a href="#cb99-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-168"><a href="#cb99-168" aria-hidden="true" tabindex="-1"></a>The distinction between the way we have been doing things and the discrete time model, is that we treat time discretely, versus continuously. This means that we transform the data from the case-duration data format to the person-period format. For this example, a natural choice would be year, since we have intervals of equal length (12 months each). </span>
<span id="cb99-169"><a href="#cb99-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-170"><a href="#cb99-170" aria-hidden="true" tabindex="-1"></a>R provides a useful function called <span class="in">`survSplit()`</span> in the <span class="in">`survival`</span> library that will split a continuous duration into discrete periods.</span>
<span id="cb99-171"><a href="#cb99-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-174"><a href="#cb99-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-175"><a href="#cb99-175" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb99-176"><a href="#cb99-176" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb99-177"><a href="#cb99-177" aria-hidden="true" tabindex="-1"></a>pp<span class="ot">&lt;-</span><span class="fu">survSplit</span>(<span class="fu">Surv</span>(secbi, b2event)<span class="sc">~</span>. , </span>
<span id="cb99-178"><a href="#cb99-178" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> sub[sub<span class="sc">$</span>secbi<span class="sc">&gt;</span><span class="dv">0</span>,],</span>
<span id="cb99-179"><a href="#cb99-179" aria-hidden="true" tabindex="-1"></a>              <span class="at">cut=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">240</span>, <span class="dv">12</span>), </span>
<span id="cb99-180"><a href="#cb99-180" aria-hidden="true" tabindex="-1"></a>              <span class="at">episode=</span><span class="st">"year_birth"</span>)</span>
<span id="cb99-181"><a href="#cb99-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-182"><a href="#cb99-182" aria-hidden="true" tabindex="-1"></a>pp<span class="sc">$</span>year <span class="ot">&lt;-</span> pp<span class="sc">$</span>year_birth<span class="dv">-1</span></span>
<span id="cb99-183"><a href="#cb99-183" aria-hidden="true" tabindex="-1"></a>pp<span class="ot">&lt;-</span>pp[<span class="fu">order</span>(pp<span class="sc">$</span>CASEID, pp<span class="sc">$</span>year_birth),]</span>
<span id="cb99-184"><a href="#cb99-184" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(pp[, <span class="fu">c</span>(<span class="st">"CASEID"</span>, <span class="st">"secbi"</span>, <span class="st">"b2event"</span>, <span class="st">"year"</span>, <span class="st">"educ"</span>, <span class="st">"agefb"</span>)], <span class="at">n=</span><span class="dv">20</span>))</span>
<span id="cb99-185"><a href="#cb99-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-186"><a href="#cb99-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-187"><a href="#cb99-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-188"><a href="#cb99-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-189"><a href="#cb99-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-190"><a href="#cb99-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-191"><a href="#cb99-191" aria-hidden="true" tabindex="-1"></a>We see that each woman is not in the data for multiple "risk periods", until they experience the event (birth) or are censored. </span>
<span id="cb99-192"><a href="#cb99-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-193"><a href="#cb99-193" aria-hidden="true" tabindex="-1"></a><span class="fu">### Discrete time model</span></span>
<span id="cb99-194"><a href="#cb99-194" aria-hidden="true" tabindex="-1"></a>So, the best thing about the discrete time model, is that it's just logistic regression. Each risk period is treated as a single Bernoulli trial, and the birth can either occur (y=1) or not (y=0) in the period. This is how we get the hazard of the event, as the estimated probability of failure in each discrete time period. So, any method you would like to use to model this probability would probably work (logit, probit models), but I will show two standard approaches.</span>
<span id="cb99-195"><a href="#cb99-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-196"><a href="#cb99-196" aria-hidden="true" tabindex="-1"></a>First, we will use the traditional logit link to the binomial distribution, then we will use the complementary log-log link. The latter is used because it preserves the proportional hazards property of the model, as in the Cox model.</span>
<span id="cb99-197"><a href="#cb99-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-198"><a href="#cb99-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-201"><a href="#cb99-201" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-202"><a href="#cb99-202" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu =</span> <span class="st">"adjust"</span>)</span>
<span id="cb99-203"><a href="#cb99-203" aria-hidden="true" tabindex="-1"></a>des<span class="ot">&lt;-</span>survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">ids=</span><span class="sc">~</span>psu,</span>
<span id="cb99-204"><a href="#cb99-204" aria-hidden="true" tabindex="-1"></a>               <span class="at">strata=</span><span class="sc">~</span>strata,</span>
<span id="cb99-205"><a href="#cb99-205" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>pp,</span>
<span id="cb99-206"><a href="#cb99-206" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight=</span><span class="sc">~</span>weight )</span>
<span id="cb99-207"><a href="#cb99-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-208"><a href="#cb99-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-209"><a href="#cb99-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-210"><a href="#cb99-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-211"><a href="#cb99-211" aria-hidden="true" tabindex="-1"></a><span class="in">```{r models1}</span></span>
<span id="cb99-212"><a href="#cb99-212" aria-hidden="true" tabindex="-1"></a><span class="co">#Fit the basic logistic model with ONLY time in the model</span></span>
<span id="cb99-213"><a href="#cb99-213" aria-hidden="true" tabindex="-1"></a><span class="co">#I do -1 so that no intercept is fit in the model, and we get a hazard estimate for each time period</span></span>
<span id="cb99-214"><a href="#cb99-214" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.0</span><span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span><span class="fu">as.factor</span>(year)<span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb99-215"><a href="#cb99-215" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des,</span>
<span id="cb99-216"><a href="#cb99-216" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-217"><a href="#cb99-217" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.0</span>)</span>
<span id="cb99-218"><a href="#cb99-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-219"><a href="#cb99-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-220"><a href="#cb99-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-223"><a href="#cb99-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-224"><a href="#cb99-224" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the hazard function on the probability scale</span></span>
<span id="cb99-225"><a href="#cb99-225" aria-hidden="true" tabindex="-1"></a>haz<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(fit<span class="fl">.0</span>)))</span>
<span id="cb99-226"><a href="#cb99-226" aria-hidden="true" tabindex="-1"></a>time<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">21</span>,<span class="dv">1</span>)</span>
<span id="cb99-227"><a href="#cb99-227" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(haz<span class="sc">~</span>time, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">ylab=</span><span class="st">"h(t)"</span>)</span>
<span id="cb99-228"><a href="#cb99-228" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"Discrete Time Hazard Function for second birth"</span>)</span>
<span id="cb99-229"><a href="#cb99-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-230"><a href="#cb99-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-231"><a href="#cb99-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-232"><a href="#cb99-232" aria-hidden="true" tabindex="-1"></a><span class="fu">### Plot the survival function estimate</span></span>
<span id="cb99-235"><a href="#cb99-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-236"><a href="#cb99-236" aria-hidden="true" tabindex="-1"></a>St<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb99-237"><a href="#cb99-237" aria-hidden="true" tabindex="-1"></a>time<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(haz)</span>
<span id="cb99-238"><a href="#cb99-238" aria-hidden="true" tabindex="-1"></a>St[<span class="dv">1</span>]<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">-</span>haz[<span class="dv">1</span>]</span>
<span id="cb99-239"><a href="#cb99-239" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(haz)){</span>
<span id="cb99-240"><a href="#cb99-240" aria-hidden="true" tabindex="-1"></a>  St[i]<span class="ot">&lt;-</span>St[i<span class="dv">-1</span>]<span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>haz[i])</span>
<span id="cb99-241"><a href="#cb99-241" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-242"><a href="#cb99-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-243"><a href="#cb99-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-244"><a href="#cb99-244" aria-hidden="true" tabindex="-1"></a>St<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span>, St)</span>
<span id="cb99-245"><a href="#cb99-245" aria-hidden="true" tabindex="-1"></a>time<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>, time)</span>
<span id="cb99-246"><a href="#cb99-246" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">y=</span>St,<span class="at">x=</span>time, <span class="at">type=</span><span class="st">"l"</span>,</span>
<span id="cb99-247"><a href="#cb99-247" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Survival function for second birth interval"</span>)</span>
<span id="cb99-248"><a href="#cb99-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-249"><a href="#cb99-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-250"><a href="#cb99-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-251"><a href="#cb99-251" aria-hidden="true" tabindex="-1"></a><span class="fu">### Alternative time specifications</span></span>
<span id="cb99-252"><a href="#cb99-252" aria-hidden="true" tabindex="-1"></a>Here, we can specify how we want time in our model. The general model fits a hazard at every time point. If you have a lot of time points, and especially if you have low numbers of events at some time points, this can be computationally expensive. </span>
<span id="cb99-253"><a href="#cb99-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-254"><a href="#cb99-254" aria-hidden="true" tabindex="-1"></a>We can, however, specify time as a linear or quadratic term, and the model will not fit separate hazards at all times, instead, the baseline hazard will be a linear or curvilinear function of time.</span>
<span id="cb99-255"><a href="#cb99-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-258"><a href="#cb99-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-259"><a href="#cb99-259" aria-hidden="true" tabindex="-1"></a><span class="co">#Linear term for time</span></span>
<span id="cb99-260"><a href="#cb99-260" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.0</span><span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb99-261"><a href="#cb99-261" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb99-262"><a href="#cb99-262" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-263"><a href="#cb99-263" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.0</span>)</span>
<span id="cb99-264"><a href="#cb99-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-265"><a href="#cb99-265" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fu">coef</span>(fit<span class="fl">.0</span>)))</span>
<span id="cb99-266"><a href="#cb99-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-267"><a href="#cb99-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-268"><a href="#cb99-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-271"><a href="#cb99-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-272"><a href="#cb99-272" aria-hidden="true" tabindex="-1"></a><span class="co">#Linear term for time</span></span>
<span id="cb99-273"><a href="#cb99-273" aria-hidden="true" tabindex="-1"></a>fit.l<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span>year,</span>
<span id="cb99-274"><a href="#cb99-274" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb99-275"><a href="#cb99-275" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-276"><a href="#cb99-276" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.l)</span>
<span id="cb99-277"><a href="#cb99-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-278"><a href="#cb99-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-279"><a href="#cb99-279" aria-hidden="true" tabindex="-1"></a>Which shows the hazard increases over time, which makes a lot of sense in the context of this outcome. Now we can consider quadratic terms for time and a natural spline function of time as well:</span>
<span id="cb99-280"><a href="#cb99-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-283"><a href="#cb99-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-284"><a href="#cb99-284" aria-hidden="true" tabindex="-1"></a>fit.s<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span>year<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb99-285"><a href="#cb99-285" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb99-286"><a href="#cb99-286" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-287"><a href="#cb99-287" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.s)</span>
<span id="cb99-288"><a href="#cb99-288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-289"><a href="#cb99-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-290"><a href="#cb99-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-293"><a href="#cb99-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-294"><a href="#cb99-294" aria-hidden="true" tabindex="-1"></a>fit.c<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span>year<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">3</span> ),</span>
<span id="cb99-295"><a href="#cb99-295" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb99-296"><a href="#cb99-296" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-297"><a href="#cb99-297" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.c)</span>
<span id="cb99-298"><a href="#cb99-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-299"><a href="#cb99-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-302"><a href="#cb99-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-303"><a href="#cb99-303" aria-hidden="true" tabindex="-1"></a>fit.q<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span>year<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">3</span> )<span class="sc">+</span><span class="fu">I</span>(year<span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb99-304"><a href="#cb99-304" aria-hidden="true" tabindex="-1"></a>              <span class="at">design=</span>des ,</span>
<span id="cb99-305"><a href="#cb99-305" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-306"><a href="#cb99-306" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.q)</span>
<span id="cb99-307"><a href="#cb99-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-308"><a href="#cb99-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-311"><a href="#cb99-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-312"><a href="#cb99-312" aria-hidden="true" tabindex="-1"></a><span class="co">#Spline</span></span>
<span id="cb99-313"><a href="#cb99-313" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb99-314"><a href="#cb99-314" aria-hidden="true" tabindex="-1"></a>fit.sp<span class="ot">&lt;-</span><span class="fu">svyglm</span>(b2event<span class="sc">~</span><span class="fu">ns</span>(year, <span class="at">df =</span> <span class="dv">3</span>),</span>
<span id="cb99-315"><a href="#cb99-315" aria-hidden="true" tabindex="-1"></a>               <span class="at">design=</span>des ,</span>
<span id="cb99-316"><a href="#cb99-316" aria-hidden="true" tabindex="-1"></a>               <span class="at">family=</span><span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-317"><a href="#cb99-317" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.sp)</span>
<span id="cb99-318"><a href="#cb99-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-319"><a href="#cb99-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-320"><a href="#cb99-320" aria-hidden="true" tabindex="-1"></a>Now, let's look at the hazards:</span>
<span id="cb99-321"><a href="#cb99-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-322"><a href="#cb99-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=9, fig.height=7}</span></span>
<span id="cb99-323"><a href="#cb99-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-324"><a href="#cb99-324" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">expand.grid</span>(<span class="at">year=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">20</span>,<span class="dv">1</span>))</span>
<span id="cb99-325"><a href="#cb99-325" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>genmod<span class="ot">&lt;-</span><span class="fu">predict</span>(fit<span class="fl">.0</span>, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">year=</span><span class="fu">as.factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> )), <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-326"><a href="#cb99-326" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>lin<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.l, <span class="at">newdata=</span>dat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-327"><a href="#cb99-327" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>sq<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.s, <span class="at">newdata=</span>dat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-328"><a href="#cb99-328" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>cub<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.c, <span class="at">newdata=</span>dat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-329"><a href="#cb99-329" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>quart<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.q, <span class="at">newdata=</span>dat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-330"><a href="#cb99-330" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>spline<span class="ot">&lt;-</span><span class="fu">predict</span>(fit.sp, <span class="at">newdata=</span><span class="fu">expand.grid</span>(<span class="at">year=</span><span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">20</span>,<span class="dv">1</span>)), <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-331"><a href="#cb99-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-332"><a href="#cb99-332" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb99-333"><a href="#cb99-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-334"><a href="#cb99-334" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(genmod<span class="sc">~</span>year, dat, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">ylab=</span><span class="st">"h(t)"</span>, <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">25</span>), <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</span>
<span id="cb99-335"><a href="#cb99-335" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main=</span><span class="st">"Hazard function from different time parameterizations"</span>)</span>
<span id="cb99-336"><a href="#cb99-336" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(lin<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">2</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb99-337"><a href="#cb99-337" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sq<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb99-338"><a href="#cb99-338" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(cub<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">4</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb99-339"><a href="#cb99-339" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(quart<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">5</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb99-340"><a href="#cb99-340" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(spline<span class="sc">~</span>year, dat, <span class="at">col=</span><span class="dv">6</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb99-341"><a href="#cb99-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-342"><a href="#cb99-342" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, </span>
<span id="cb99-343"><a href="#cb99-343" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"General Model"</span>, <span class="st">"Linear"</span>,<span class="st">"Square"</span>, <span class="st">"Cubic"</span>, <span class="st">"Quartic"</span>, <span class="st">"Natural spline"</span>),</span>
<span id="cb99-344"><a href="#cb99-344" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)</span>
<span id="cb99-345"><a href="#cb99-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-346"><a href="#cb99-346" aria-hidden="true" tabindex="-1"></a><span class="co">#AIC table</span></span>
<span id="cb99-347"><a href="#cb99-347" aria-hidden="true" tabindex="-1"></a>aic<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">c</span>(</span>
<span id="cb99-348"><a href="#cb99-348" aria-hidden="true" tabindex="-1"></a>  fit.l<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.l<span class="sc">$</span>coefficients),</span>
<span id="cb99-349"><a href="#cb99-349" aria-hidden="true" tabindex="-1"></a>  fit.s<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.s<span class="sc">$</span>coefficients),</span>
<span id="cb99-350"><a href="#cb99-350" aria-hidden="true" tabindex="-1"></a>  fit.c<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.c<span class="sc">$</span>coefficients),</span>
<span id="cb99-351"><a href="#cb99-351" aria-hidden="true" tabindex="-1"></a>  fit.q<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.q<span class="sc">$</span>coefficients),</span>
<span id="cb99-352"><a href="#cb99-352" aria-hidden="true" tabindex="-1"></a>  fit.sp<span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit.sp<span class="sc">$</span>coefficients),</span>
<span id="cb99-353"><a href="#cb99-353" aria-hidden="true" tabindex="-1"></a>  fit<span class="fl">.0</span><span class="sc">$</span>deviance<span class="sc">+</span><span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(fit<span class="fl">.0</span><span class="sc">$</span>coefficients)),<span class="dv">2</span>)</span>
<span id="cb99-354"><a href="#cb99-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-355"><a href="#cb99-355" aria-hidden="true" tabindex="-1"></a><span class="co">#compare all aics to the one from the general model</span></span>
<span id="cb99-356"><a href="#cb99-356" aria-hidden="true" tabindex="-1"></a>dif.aic<span class="ot">&lt;-</span><span class="fu">round</span>(aic<span class="sc">-</span>aic[<span class="dv">6</span>],<span class="dv">2</span>)</span>
<span id="cb99-357"><a href="#cb99-357" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">model =</span><span class="fu">c</span>( <span class="st">"linear"</span>,<span class="st">"square"</span>, <span class="st">"cubic"</span>, <span class="st">"quartic"</span>,<span class="st">"spline"</span>, <span class="st">"general"</span>),</span>
<span id="cb99-358"><a href="#cb99-358" aria-hidden="true" tabindex="-1"></a>           <span class="at">aic=</span>aic,</span>
<span id="cb99-359"><a href="#cb99-359" aria-hidden="true" tabindex="-1"></a>           <span class="at">aic_dif=</span>dif.aic)</span>
<span id="cb99-360"><a href="#cb99-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-361"><a href="#cb99-361" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-362"><a href="#cb99-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-363"><a href="#cb99-363" aria-hidden="true" tabindex="-1"></a>So the general model, quartic and spline give the same AIC points, but the square and cubic models also fit equally as well. </span>
<span id="cb99-364"><a href="#cb99-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-365"><a href="#cb99-365" aria-hidden="true" tabindex="-1"></a><span class="fu">## IPUMS NHIS Mortality example</span></span>
<span id="cb99-366"><a href="#cb99-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-367"><a href="#cb99-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning=FALSE}</span></span>
<span id="cb99-368"><a href="#cb99-368" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb99-369"><a href="#cb99-369" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb99-370"><a href="#cb99-370" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb99-371"><a href="#cb99-371" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span>haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">"C:/Users/ozd504/OneDrive - University of Texas at San Antonio/classes/dem7223/dem7223_22//data/nhis_00012.dta"</span>)</span>
<span id="cb99-372"><a href="#cb99-372" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dat)</span>
<span id="cb99-373"><a href="#cb99-373" aria-hidden="true" tabindex="-1"></a>sub<span class="ot">&lt;-</span><span class="fu">subset</span>(dat, dat<span class="sc">$</span>mortelig<span class="sc">==</span><span class="dv">1</span><span class="sc">&amp;</span><span class="fu">is.na</span>(dat<span class="sc">$</span>racenew)<span class="sc">==</span>F)</span>
<span id="cb99-374"><a href="#cb99-374" aria-hidden="true" tabindex="-1"></a>samps<span class="ot">&lt;-</span><span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sub<span class="sc">$</span>year), <span class="at">size =</span> <span class="dv">100000</span>, <span class="at">replace =</span> F)</span>
<span id="cb99-375"><a href="#cb99-375" aria-hidden="true" tabindex="-1"></a>sub<span class="ot">&lt;-</span>sub[samps,]</span>
<span id="cb99-376"><a href="#cb99-376" aria-hidden="true" tabindex="-1"></a>sub<span class="ot">&lt;-</span><span class="fu">zap_labels</span>(sub)</span>
<span id="cb99-377"><a href="#cb99-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-378"><a href="#cb99-378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-379"><a href="#cb99-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-380"><a href="#cb99-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-381"><a href="#cb99-381" aria-hidden="true" tabindex="-1"></a><span class="fu">### alternative codings of failure time</span></span>
<span id="cb99-382"><a href="#cb99-382" aria-hidden="true" tabindex="-1"></a>In mortality analysis, but in any type of case-duration data, we can construct our event indicator to represent if an event occurs during a set risk period. In the NHIS mortality, we could code the death as a few different ways:</span>
<span id="cb99-383"><a href="#cb99-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-384"><a href="#cb99-384" aria-hidden="true" tabindex="-1"></a>If you are interested in the *Age at death*, then you will measure your outcome as the age when they died</span>
<span id="cb99-385"><a href="#cb99-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-386"><a href="#cb99-386" aria-hidden="true" tabindex="-1"></a>Coding age at death. If the person died, then it is equal to the year the person died, minus the year in which they were born. If the person was still alive, then it is the difference between 2009 (year of follow up in this data file)</span>
<span id="cb99-387"><a href="#cb99-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-390"><a href="#cb99-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-391"><a href="#cb99-391" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>d.age<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">1</span>,sub<span class="sc">$</span>mortdody<span class="sc">-</span>(sub<span class="sc">$</span>year<span class="sc">-</span>sub<span class="sc">$</span>age) ,</span>
<span id="cb99-392"><a href="#cb99-392" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">ifelse</span>(sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">2</span>,<span class="dv">2009</span><span class="sc">-</span>(sub<span class="sc">$</span>year<span class="sc">-</span>sub<span class="sc">$</span>age), <span class="cn">NA</span>))</span>
<span id="cb99-393"><a href="#cb99-393" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-394"><a href="#cb99-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-395"><a href="#cb99-395" aria-hidden="true" tabindex="-1"></a>If you are interested in the risk of death in a follow up period, then you could code it as:</span>
<span id="cb99-396"><a href="#cb99-396" aria-hidden="true" tabindex="-1"></a><span class="ss"> - </span>Did the person die in the follow up period at all? No time specified</span>
<span id="cb99-397"><a href="#cb99-397" aria-hidden="true" tabindex="-1"></a><span class="ss"> - </span>Did the person die in a 1, 5, or 10 year period? This specifies a fixed risk period</span>
<span id="cb99-398"><a href="#cb99-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-399"><a href="#cb99-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-400"><a href="#cb99-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-403"><a href="#cb99-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-404"><a href="#cb99-404" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>d.event<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>) <span class="co">#did they die?</span></span>
<span id="cb99-405"><a href="#cb99-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-406"><a href="#cb99-406" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>timetodeath<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>mortstat <span class="sc">==</span><span class="dv">1</span>, </span>
<span id="cb99-407"><a href="#cb99-407" aria-hidden="true" tabindex="-1"></a>                        sub<span class="sc">$</span>mortdody<span class="sc">-</span>sub<span class="sc">$</span>year  ,</span>
<span id="cb99-408"><a href="#cb99-408" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">2009</span> <span class="sc">-</span> sub<span class="sc">$</span>year ) <span class="co">#how long after the interview did they die?</span></span>
<span id="cb99-409"><a href="#cb99-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-410"><a href="#cb99-410" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>d1yr<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>timetodeath<span class="sc">&lt;=</span><span class="dv">1</span><span class="sc">&amp;</span>sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>) <span class="co">#did they die within 1 year of the interview</span></span>
<span id="cb99-411"><a href="#cb99-411" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>d5yr<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>timetodeath<span class="sc">&lt;=</span><span class="dv">5</span><span class="sc">&amp;</span>sub<span class="sc">$</span>mortstat<span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>,<span class="dv">0</span>) <span class="co">#did they die within 5 years of the interview</span></span>
<span id="cb99-412"><a href="#cb99-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-413"><a href="#cb99-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-414"><a href="#cb99-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-415"><a href="#cb99-415" aria-hidden="true" tabindex="-1"></a>Other variables</span>
<span id="cb99-416"><a href="#cb99-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-419"><a href="#cb99-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-420"><a href="#cb99-420" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb99-421"><a href="#cb99-421" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>married<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>marstat,</span>
<span id="cb99-422"><a href="#cb99-422" aria-hidden="true" tabindex="-1"></a>                    <span class="at">recodes=</span><span class="st">"00=NA; 10:13='married'; 20:40='sep'; 50='nm'; 99=NA"</span> ,</span>
<span id="cb99-423"><a href="#cb99-423" aria-hidden="true" tabindex="-1"></a>                    <span class="at">as.factor=</span>T )</span>
<span id="cb99-424"><a href="#cb99-424" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>male<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>sex<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb99-425"><a href="#cb99-425" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>mwt<span class="ot">&lt;-</span>sub<span class="sc">$</span>mortwt<span class="sc">/</span><span class="fu">mean</span>(sub<span class="sc">$</span>mortwt, <span class="at">na.rm=</span>T)</span>
<span id="cb99-426"><a href="#cb99-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-427"><a href="#cb99-427" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>age5<span class="ot">&lt;-</span><span class="fu">cut</span>(sub<span class="sc">$</span>age,<span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">85</span>, <span class="dv">5</span>))</span>
<span id="cb99-428"><a href="#cb99-428" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-429"><a href="#cb99-429" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>racenew,</span>
<span id="cb99-430"><a href="#cb99-430" aria-hidden="true" tabindex="-1"></a>                 <span class="at">recodes =</span><span class="st">"10='wht'; 20 ='blk'; 30:61='other'; 97:99=NA"</span>,</span>
<span id="cb99-431"><a href="#cb99-431" aria-hidden="true" tabindex="-1"></a>                 <span class="at">as.factor=</span>T)</span>
<span id="cb99-432"><a href="#cb99-432" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>college<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>educrec2,</span>
<span id="cb99-433"><a href="#cb99-433" aria-hidden="true" tabindex="-1"></a>                    <span class="at">recodes=</span><span class="st">"00=NA; 10:42='hs or less'; 50:53='some coll'; 54:60='coll'; else=NA"</span>,</span>
<span id="cb99-434"><a href="#cb99-434" aria-hidden="true" tabindex="-1"></a>                    <span class="at">as.factor=</span>T)</span>
<span id="cb99-435"><a href="#cb99-435" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>black<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">'blk'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb99-436"><a href="#cb99-436" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>oth<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">'other'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb99-437"><a href="#cb99-437" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>hs<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>college<span class="sc">==</span><span class="st">'hs or less'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb99-438"><a href="#cb99-438" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>col1<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>college<span class="sc">==</span><span class="st">'some coll'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb99-439"><a href="#cb99-439" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>sep<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>married<span class="sc">==</span><span class="st">'sep'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb99-440"><a href="#cb99-440" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>nm<span class="ot">&lt;-</span><span class="fu">ifelse</span>(sub<span class="sc">$</span>married<span class="sc">==</span><span class="st">'nm'</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb99-441"><a href="#cb99-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-442"><a href="#cb99-442" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>racenew, <span class="at">recodes =</span><span class="st">"10='wht'; 20 ='blk'; 30:61='other'; 97:99=NA"</span>, <span class="at">as.factor=</span>T)</span>
<span id="cb99-443"><a href="#cb99-443" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>hisp<span class="ot">&lt;-</span><span class="fu">Recode</span>(sub<span class="sc">$</span>hispyn, <span class="at">recodes=</span><span class="st">"1=0; 2=1; else=NA"</span>)</span>
<span id="cb99-444"><a href="#cb99-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-445"><a href="#cb99-445" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[sub<span class="sc">$</span>hisp <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">"wht"</span>]<span class="ot">&lt;-</span><span class="st">"NHWhite"</span></span>
<span id="cb99-446"><a href="#cb99-446" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[sub<span class="sc">$</span>hisp <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">"blk"</span>]<span class="ot">&lt;-</span><span class="st">"NHBlack"</span></span>
<span id="cb99-447"><a href="#cb99-447" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[sub<span class="sc">$</span>hisp <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> sub<span class="sc">$</span>race<span class="sc">==</span><span class="st">"other"</span>]<span class="ot">&lt;-</span><span class="st">"NHother"</span></span>
<span id="cb99-448"><a href="#cb99-448" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[sub<span class="sc">$</span>hisp <span class="sc">==</span> <span class="dv">1</span> ]<span class="ot">&lt;-</span><span class="st">"Hispanic"</span></span>
<span id="cb99-449"><a href="#cb99-449" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth[<span class="fu">is.na</span>(sub<span class="sc">$</span>hisp) <span class="sc">==</span>T <span class="sc">|</span> <span class="fu">is.na</span>(sub<span class="sc">$</span>race)<span class="sc">==</span>T]<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb99-450"><a href="#cb99-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-451"><a href="#cb99-451" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb99-452"><a href="#cb99-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-453"><a href="#cb99-453" aria-hidden="true" tabindex="-1"></a>sub<span class="sc">$</span>race_eth<span class="ot">&lt;-</span><span class="fu">fct_relevel</span>(sub<span class="sc">$</span>race_eth, <span class="fu">c</span>(<span class="st">"NHWhite"</span>, <span class="st">"NHBlack"</span> , <span class="st">"Hispanic"</span>, <span class="st">"NHother"</span>))</span>
<span id="cb99-454"><a href="#cb99-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-455"><a href="#cb99-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-456"><a href="#cb99-456" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create person - period file</span></span>
<span id="cb99-457"><a href="#cb99-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-460"><a href="#cb99-460" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-461"><a href="#cb99-461" aria-hidden="true" tabindex="-1"></a>subpp<span class="ot">&lt;-</span><span class="fu">survSplit</span>(<span class="fu">Surv</span>(d.age, d.event)<span class="sc">~</span>., <span class="at">data=</span>sub,</span>
<span id="cb99-462"><a href="#cb99-462" aria-hidden="true" tabindex="-1"></a><span class="at">cut=</span><span class="fu">seq</span>(<span class="dv">18</span>, <span class="dv">100</span>, <span class="dv">5</span>),  <span class="at">episode=</span><span class="st">"mort_5_yr"</span>)</span>
<span id="cb99-463"><a href="#cb99-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-464"><a href="#cb99-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-465"><a href="#cb99-465" aria-hidden="true" tabindex="-1"></a>Analysis of death outcome </span>
<span id="cb99-466"><a href="#cb99-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-469"><a href="#cb99-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-470"><a href="#cb99-470" aria-hidden="true" tabindex="-1"></a>des2<span class="ot">&lt;-</span><span class="fu">svydesign</span>(<span class="at">ids=</span><span class="sc">~</span>psu, <span class="at">strata=</span><span class="sc">~</span>strata,</span>
<span id="cb99-471"><a href="#cb99-471" aria-hidden="true" tabindex="-1"></a>                <span class="at">weights =</span> <span class="sc">~</span>perweight, <span class="at">data=</span>subpp, <span class="at">nest=</span>T)</span>
<span id="cb99-472"><a href="#cb99-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-473"><a href="#cb99-473" aria-hidden="true" tabindex="-1"></a><span class="co"># constant model</span></span>
<span id="cb99-474"><a href="#cb99-474" aria-hidden="true" tabindex="-1"></a>m0<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span> race_eth<span class="sc">+</span>college,</span>
<span id="cb99-475"><a href="#cb99-475" aria-hidden="true" tabindex="-1"></a>           <span class="at">design=</span>des2, <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-476"><a href="#cb99-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-477"><a href="#cb99-477" aria-hidden="true" tabindex="-1"></a><span class="co">#general model</span></span>
<span id="cb99-478"><a href="#cb99-478" aria-hidden="true" tabindex="-1"></a>m1<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span><span class="fu">factor</span>(mort_5_yr) <span class="sc">+</span> race_eth<span class="sc">+</span>college,</span>
<span id="cb99-479"><a href="#cb99-479" aria-hidden="true" tabindex="-1"></a>           <span class="at">design=</span>des2, <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-480"><a href="#cb99-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-481"><a href="#cb99-481" aria-hidden="true" tabindex="-1"></a><span class="co">#linear model</span></span>
<span id="cb99-482"><a href="#cb99-482" aria-hidden="true" tabindex="-1"></a>m2<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span>mort_5_yr<span class="sc">+</span>race_eth<span class="sc">+</span>college, <span class="at">design=</span>des2,</span>
<span id="cb99-483"><a href="#cb99-483" aria-hidden="true" tabindex="-1"></a>           <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-484"><a href="#cb99-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-485"><a href="#cb99-485" aria-hidden="true" tabindex="-1"></a><span class="co">#quadratic model</span></span>
<span id="cb99-486"><a href="#cb99-486" aria-hidden="true" tabindex="-1"></a>m3<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span>mort_5_yr<span class="sc">+</span> <span class="fu">I</span>(mort_5_yr<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>race_eth<span class="sc">+</span>college,</span>
<span id="cb99-487"><a href="#cb99-487" aria-hidden="true" tabindex="-1"></a>           <span class="at">design=</span>des2, <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-488"><a href="#cb99-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-489"><a href="#cb99-489" aria-hidden="true" tabindex="-1"></a><span class="co">#spline model</span></span>
<span id="cb99-490"><a href="#cb99-490" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb99-491"><a href="#cb99-491" aria-hidden="true" tabindex="-1"></a>m4<span class="ot">&lt;-</span><span class="fu">svyglm</span>(d.event<span class="sc">~</span><span class="fu">ns</span>(mort_5_yr, <span class="at">df=</span><span class="dv">3</span>)<span class="sc">+</span>race_eth<span class="sc">+</span>college, <span class="at">design=</span>des2,</span>
<span id="cb99-492"><a href="#cb99-492" aria-hidden="true" tabindex="-1"></a>           <span class="at">family=</span><span class="fu">binomial</span> (<span class="at">link=</span><span class="st">"cloglog"</span>))</span>
<span id="cb99-493"><a href="#cb99-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-494"><a href="#cb99-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-495"><a href="#cb99-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-496"><a href="#cb99-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-497"><a href="#cb99-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-498"><a href="#cb99-498" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generate hazard plots</span></span>
<span id="cb99-499"><a href="#cb99-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-502"><a href="#cb99-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-503"><a href="#cb99-503" aria-hidden="true" tabindex="-1"></a>newdat<span class="ot">&lt;-</span><span class="fu">expand.grid</span>(<span class="at">mort_5_yr =</span> <span class="fu">unique</span>(subpp<span class="sc">$</span>mort_5_yr), </span>
<span id="cb99-504"><a href="#cb99-504" aria-hidden="true" tabindex="-1"></a>                    <span class="at">race_eth=</span> <span class="fu">unique</span>(subpp<span class="sc">$</span>race_eth), </span>
<span id="cb99-505"><a href="#cb99-505" aria-hidden="true" tabindex="-1"></a>                    <span class="at">college =</span> <span class="fu">unique</span>(subpp<span class="sc">$</span>college))</span>
<span id="cb99-506"><a href="#cb99-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-507"><a href="#cb99-507" aria-hidden="true" tabindex="-1"></a>newdat<span class="ot">&lt;-</span>newdat<span class="sc">%&gt;%</span></span>
<span id="cb99-508"><a href="#cb99-508" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">complete.cases</span>(.))</span>
<span id="cb99-509"><a href="#cb99-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-510"><a href="#cb99-510" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h0<span class="ot">&lt;-</span><span class="fu">predict</span>(m0, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-511"><a href="#cb99-511" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h1<span class="ot">&lt;-</span><span class="fu">predict</span>(m1, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-512"><a href="#cb99-512" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h2<span class="ot">&lt;-</span><span class="fu">predict</span>(m2, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-513"><a href="#cb99-513" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h3<span class="ot">&lt;-</span><span class="fu">predict</span>(m3, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-514"><a href="#cb99-514" aria-hidden="true" tabindex="-1"></a>newdat<span class="sc">$</span>h4<span class="ot">&lt;-</span><span class="fu">predict</span>(m4, <span class="at">newdata=</span>newdat, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb99-515"><a href="#cb99-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-516"><a href="#cb99-516" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(newdat)</span>
<span id="cb99-517"><a href="#cb99-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-518"><a href="#cb99-518" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb99-519"><a href="#cb99-519" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb99-520"><a href="#cb99-520" aria-hidden="true" tabindex="-1"></a>out<span class="ot">&lt;-</span><span class="fu">melt</span>(<span class="fu">setDT</span>(newdat),</span>
<span id="cb99-521"><a href="#cb99-521" aria-hidden="true" tabindex="-1"></a>          <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"mort_5_yr"</span>, <span class="st">"race_eth"</span>, <span class="st">"college"</span>),</span>
<span id="cb99-522"><a href="#cb99-522" aria-hidden="true" tabindex="-1"></a>          <span class="at">measure.vars =</span> <span class="fu">list</span>(<span class="at">haz=</span><span class="fu">c</span>(<span class="st">"h0"</span>, <span class="st">"h1"</span>,<span class="st">"h2"</span>,<span class="st">"h3"</span>, <span class="st">"h4"</span>)))</span>
<span id="cb99-523"><a href="#cb99-523" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out, <span class="at">n=</span><span class="dv">20</span>)</span>
<span id="cb99-524"><a href="#cb99-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-525"><a href="#cb99-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-526"><a href="#cb99-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-527"><a href="#cb99-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-528"><a href="#cb99-528" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb99-529"><a href="#cb99-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-530"><a href="#cb99-530" aria-hidden="true" tabindex="-1"></a>out<span class="sc">%&gt;%</span></span>
<span id="cb99-531"><a href="#cb99-531" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(college <span class="sc">==</span> <span class="st">"coll"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb99-532"><a href="#cb99-532" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">mod =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(.<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h0"</span> <span class="sc">~</span> <span class="st">"Constant"</span>,</span>
<span id="cb99-533"><a href="#cb99-533" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h1"</span> <span class="sc">~</span> <span class="st">"General"</span>,</span>
<span id="cb99-534"><a href="#cb99-534" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h2"</span> <span class="sc">~</span> <span class="st">"Linear"</span>,</span>
<span id="cb99-535"><a href="#cb99-535" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h3"</span> <span class="sc">~</span> <span class="st">"Polynomial - 2"</span>,</span>
<span id="cb99-536"><a href="#cb99-536" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">$</span>variable <span class="sc">==</span><span class="st">"h4"</span> <span class="sc">~</span> <span class="st">"Spline"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb99-537"><a href="#cb99-537" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mort_5_yr<span class="sc">*</span><span class="dv">5</span>, <span class="at">y=</span>value ))<span class="sc">+</span></span>
<span id="cb99-538"><a href="#cb99-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span>race_eth, <span class="at">color=</span>race_eth) )<span class="sc">+</span></span>
<span id="cb99-539"><a href="#cb99-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hazard function for adult mortality"</span>, </span>
<span id="cb99-540"><a href="#cb99-540" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Alternative model specifications"</span>)<span class="sc">+</span></span>
<span id="cb99-541"><a href="#cb99-541" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Age"</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"S(t)"</span>)<span class="sc">+</span></span>
<span id="cb99-542"><a href="#cb99-542" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mod)<span class="co">#+ scale_y_continuous(trans = "log10")</span></span>
<span id="cb99-543"><a href="#cb99-543" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-544"><a href="#cb99-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-545"><a href="#cb99-545" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model fits</span></span>
<span id="cb99-546"><a href="#cb99-546" aria-hidden="true" tabindex="-1"></a>Here we construct a table of the relative model fits for the five different time specifications</span>
<span id="cb99-549"><a href="#cb99-549" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb99-550"><a href="#cb99-550" aria-hidden="true" tabindex="-1"></a>AIC0<span class="ot">&lt;-</span><span class="fu">AIC</span>(m0)</span>
<span id="cb99-551"><a href="#cb99-551" aria-hidden="true" tabindex="-1"></a>AIC1<span class="ot">&lt;-</span><span class="fu">AIC</span>(m1)</span>
<span id="cb99-552"><a href="#cb99-552" aria-hidden="true" tabindex="-1"></a>AIC2<span class="ot">&lt;-</span><span class="fu">AIC</span>(m2)</span>
<span id="cb99-553"><a href="#cb99-553" aria-hidden="true" tabindex="-1"></a>AIC3<span class="ot">&lt;-</span><span class="fu">AIC</span>(m3)</span>
<span id="cb99-554"><a href="#cb99-554" aria-hidden="true" tabindex="-1"></a>AIC4<span class="ot">&lt;-</span><span class="fu">AIC</span>(m4)</span>
<span id="cb99-555"><a href="#cb99-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-556"><a href="#cb99-556" aria-hidden="true" tabindex="-1"></a>AICS<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">AIC =</span> <span class="fu">c</span>(AIC0[<span class="st">"AIC"</span>],AIC1[<span class="st">"AIC"</span>],AIC2[<span class="st">"AIC"</span>],AIC3[<span class="st">"AIC"</span>],AIC4[<span class="st">"AIC"</span>]),</span>
<span id="cb99-557"><a href="#cb99-557" aria-hidden="true" tabindex="-1"></a>                 <span class="at">mod =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"const"</span>, <span class="st">"general"</span>, <span class="st">"linear"</span>, <span class="st">"poly 2"</span>, <span class="st">"spline"</span>)) )</span>
<span id="cb99-558"><a href="#cb99-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-559"><a href="#cb99-559" aria-hidden="true" tabindex="-1"></a>AICS<span class="sc">$</span>mod<span class="ot">&lt;-</span>forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(AICS<span class="sc">$</span>mod,</span>
<span id="cb99-560"><a href="#cb99-560" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">c</span>(<span class="st">"general"</span>, <span class="st">"const"</span> , <span class="st">"linear"</span>, <span class="st">"poly2"</span>, <span class="st">"spline"</span>))</span>
<span id="cb99-561"><a href="#cb99-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-562"><a href="#cb99-562" aria-hidden="true" tabindex="-1"></a>AICS<span class="sc">$</span>deltaAIC<span class="ot">&lt;-</span>AICS<span class="sc">$</span>AIC <span class="sc">-</span> AICS<span class="sc">$</span>AIC[AICS<span class="sc">$</span>mod<span class="sc">==</span><span class="st">"general"</span>]</span>
<span id="cb99-563"><a href="#cb99-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-564"><a href="#cb99-564" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(AICS[, <span class="fu">c</span>(<span class="st">"mod"</span>, <span class="st">"AIC"</span>, <span class="st">"deltaAIC"</span>)],</span>
<span id="cb99-565"><a href="#cb99-565" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">"Relative AIC for alternative time specifications"</span>)</span>
<span id="cb99-566"><a href="#cb99-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-567"><a href="#cb99-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb99-568"><a href="#cb99-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-569"><a href="#cb99-569" aria-hidden="true" tabindex="-1"></a>We see that nothing touches the AIC for the general model in this case. </span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>