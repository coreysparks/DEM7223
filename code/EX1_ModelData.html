<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Corey S. Sparks, PhD">
<meta name="dcterms.date" content="2022-08-04">
<title>DEM 7223 - Introduction to Event History Analysis and Functions of Survival Time</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="EX1_ModelData_files/libs/clipboard/clipboard.min.js"></script>
<script src="EX1_ModelData_files/libs/quarto-html/quarto.js"></script>
<script src="EX1_ModelData_files/libs/quarto-html/popper.min.js"></script>
<script src="EX1_ModelData_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="EX1_ModelData_files/libs/quarto-html/anchor.min.js"></script>
<link href="EX1_ModelData_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EX1_ModelData_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="EX1_ModelData_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="EX1_ModelData_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="EX1_ModelData_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script src="EX1_ModelData_files/libs/kePrint-0.0.1/kePrint.js"></script><link href="EX1_ModelData_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="EX1_ModelData_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="EX1_ModelData_files/libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#rational-for-event-history-analysis" id="toc-rational-for-event-history-analysis" class="nav-link active" data-scroll-target="#rational-for-event-history-analysis">Rational for Event history analysis</a>
  <ul class="collapse">
<li><a href="#when-to-conduct-an-event-history-analysis" id="toc-when-to-conduct-an-event-history-analysis" class="nav-link" data-scroll-target="#when-to-conduct-an-event-history-analysis">When to conduct an event history analysis?</a></li>
  <li><a href="#basic-propositions" id="toc-basic-propositions" class="nav-link" data-scroll-target="#basic-propositions">Basic Propositions</a></li>
  <li><a href="#focus-on-comparison" id="toc-focus-on-comparison" class="nav-link" data-scroll-target="#focus-on-comparison">Focus on comparison</a></li>
  <li><a href="#some-terminology" id="toc-some-terminology" class="nav-link" data-scroll-target="#some-terminology">Some terminology</a></li>
  <li><a href="#issues-in-event-history-data" id="toc-issues-in-event-history-data" class="nav-link" data-scroll-target="#issues-in-event-history-data">Issues in event history data</a></li>
  <li><a href="#time-scales" id="toc-time-scales" class="nav-link" data-scroll-target="#time-scales">Time Scales</a></li>
  <li><a href="#kinds-of-studies-with-event-history-data" id="toc-kinds-of-studies-with-event-history-data" class="nav-link" data-scroll-target="#kinds-of-studies-with-event-history-data">Kinds of studies with event history data</a></li>
  <li>
<a href="#some-arrangements-for-event-history-data" id="toc-some-arrangements-for-event-history-data" class="nav-link" data-scroll-target="#some-arrangements-for-event-history-data">Some arrangements for event history data</a>
  <ul class="collapse">
<li><a href="#counting-process-data" id="toc-counting-process-data" class="nav-link" data-scroll-target="#counting-process-data">Counting process data</a></li>
  <li><a href="#case---duration-or-person-level-data" id="toc-case---duration-or-person-level-data" class="nav-link" data-scroll-target="#case---duration-or-person-level-data">Case - duration, or person level data</a></li>
  <li><a href="#person-period-data" id="toc-person-period-data" class="nav-link" data-scroll-target="#person-period-data">Person – Period data</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#functions-of-survival-time" id="toc-functions-of-survival-time" class="nav-link" data-scroll-target="#functions-of-survival-time">Functions of Survival Time</a>
  <ul class="collapse">
<li><a href="#homage-to-the-life-table" id="toc-homage-to-the-life-table" class="nav-link" data-scroll-target="#homage-to-the-life-table">Homage to the life table</a></li>
  <li>
<a href="#life-tables-and-event-history-analysis" id="toc-life-tables-and-event-history-analysis" class="nav-link" data-scroll-target="#life-tables-and-event-history-analysis">Life tables and Event History Analysis</a>
  <ul class="collapse">
<li><a href="#defining-the-functions" id="toc-defining-the-functions" class="nav-link" data-scroll-target="#defining-the-functions">Defining the functions</a></li>
  <li><a href="#the-distribution-function-or-pdf" id="toc-the-distribution-function-or-pdf" class="nav-link" data-scroll-target="#the-distribution-function-or-pdf">The distribution function, or <em>pdf</em></a></li>
  <li><a href="#survival-function" id="toc-survival-function" class="nav-link" data-scroll-target="#survival-function">Survival Function</a></li>
  <li><a href="#the-hazard-function" id="toc-the-hazard-function" class="nav-link" data-scroll-target="#the-hazard-function">The hazard function</a></li>
  </ul>
</li>
  <li>
<a href="#relationships-among-the-three-functions" id="toc-relationships-among-the-three-functions" class="nav-link" data-scroll-target="#relationships-among-the-three-functions">Relationships among the three functions</a>
  <ul class="collapse">
<li><a href="#more-on-the-hazard-function" id="toc-more-on-the-hazard-function" class="nav-link" data-scroll-target="#more-on-the-hazard-function">More on the hazard function…</a></li>
  </ul>
</li>
  <li><a href="#example-from-data" id="toc-example-from-data" class="nav-link" data-scroll-target="#example-from-data">Example from data</a></li>
  <li><a href="#event---infant-mortality" id="toc-event---infant-mortality" class="nav-link" data-scroll-target="#event---infant-mortality">Event - Infant Mortality</a></li>
  <li><a href="#example-of-estimating-survival-time-functions-from-data" id="toc-example-of-estimating-survival-time-functions-from-data" class="nav-link" data-scroll-target="#example-of-estimating-survival-time-functions-from-data">Example of Estimating Survival Time Functions from data</a></li>
  </ul>
</li>
  </ul></nav>
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">DEM 7223 - Introduction to Event History Analysis and Functions of Survival Time</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://coreysparks.github.io">Corey S. Sparks, PhD</a> 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://hcap.utsa.edu/demography">The University of Texas at San Antonio</a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 4, 2022</p>
    </div>
  </div>
    
  </div>
  

</header><div class="cell">

</div>
<section id="rational-for-event-history-analysis" class="level1"><h1>Rational for Event history analysis</h1>
<section id="when-to-conduct-an-event-history-analysis" class="level3"><h3 class="anchored" data-anchor-id="when-to-conduct-an-event-history-analysis">When to conduct an event history analysis?</h3>
<ul>
<li>When you questions include
<ul>
<li>When or Whether</li>
<li>When &gt; how long until an event occurs</li>
<li>Whether &gt; does an event occur or not</li>
</ul>
</li>
<li>If your question does not include either of these ideas (or cannot be made to) then you do not need to do event history analysis</li>
</ul></section><section id="basic-propositions" class="level3"><h3 class="anchored" data-anchor-id="basic-propositions">Basic Propositions</h3>
<ul>
<li>Since most of the methods we will discuss originate from studies of mortality, they have morbid names
<ul>
<li>Survival – This is related to how long a case lasts until it experiences the event of interest</li>
<li>How long does it take?</li>
<li>Risk – How likely is it that the case will experience the event</li>
<li>Will it happen or not?</li>
</ul>
</li>
</ul></section><section id="focus-on-comparison" class="level3"><h3 class="anchored" data-anchor-id="focus-on-comparison">Focus on comparison</h3>
<ul>
<li>Most of the methods we consider are comparative by their nature</li>
<li>How long does a case with trait x survive, compared to a case with trait y?</li>
<li>How likely is it for a person who is married to die of homicide relative to someone who is single?</li>
<li>Generally we are examining relative risk and relative survival</li>
</ul></section><section id="some-terminology" class="level3"><h3 class="anchored" data-anchor-id="some-terminology">Some terminology</h3>
<p>It is important to establish some key vocabulary we will use throughout the course. These terms are essential to our modeling and thinking about structuring our data and measuring our outcomes. We will use a simple example of the time to first birth to illustrate.</p>
<ul>
<li>
<strong>State</strong> – discrete condition an individual may occupy that occur within a state space. Most survival analysis methods assume a single state to state transition.
<ul>
<li>e.g.&nbsp;for our example the two states would be: Childless and having 1 child born</li>
</ul>
</li>
<li>
<strong>State space</strong> – full set of state alternatives
<ul>
<li>e.g.&nbsp;the two states would be: Childless and having 1 child born</li>
</ul>
</li>
<li>
<strong>Episodes/Events/Transitions</strong> – a change in states
<ul>
<li>The transition would be having a first child. The event would be coded as 0/1 based on whether a woman has had a fist child or not</li>
</ul>
</li>
<li>
<strong>Durations</strong> – length of an episode
<ul>
<li>The duration here would be the length of time between the start of the risk (for this outcome, it’s typically marriage) and the time of the first birth.</li>
</ul>
</li>
<li>
<strong>Time axis</strong> – Metric for measuring durations (days, months, years)
<ul>
<li>Time could be measured in days, weeks, months, or even years.</li>
</ul>
</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/state_concepts.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">State Space Illustration</figcaption><p></p>
</figure>
</div>
</section><section id="issues-in-event-history-data" class="level3"><h3 class="anchored" data-anchor-id="issues-in-event-history-data">Issues in event history data</h3>
<section id="censoring" class="level4"><h4 class="anchored" data-anchor-id="censoring">Censoring</h4>
<ul>
<li>
<strong>Censoring</strong> occurs when you do not actually observe the event of interest within the period of data collection
<ul>
<li>e.g.&nbsp;you know someone gets married, but you never observe them having a child</li>
<li>e.g.&nbsp;someone leaves alcohol treatment and is never observed drinking again</li>
</ul>
</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/censoring.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Censoring</figcaption><p></p>
</figure>
</div>
</section><section id="non-informative-censoring" class="level4"><h4 class="anchored" data-anchor-id="non-informative-censoring">Non-informative censoring</h4>
<ul>
<li>The individual is not observed because the observer ends the study period</li>
<li>The censoring is not related to any trait or action of the case, but related to the observer
<ul>
<li>We want most of our censoring to be this kind</li>
</ul>
</li>
</ul></section><section id="informative-censoring" class="level4"><h4 class="anchored" data-anchor-id="informative-censoring">Informative censoring</h4>
<ul>
<li>The individual is not observed because they represent a special case</li>
<li>The censoring IS related to something about the individual, and these people differ inherently from uncensored cases</li>
<li>People that are censored ARE likely to have experience the event</li>
</ul></section><section id="right-censoring" class="level4"><h4 class="anchored" data-anchor-id="right-censoring">Right censoring</h4>
<ul>
<li>An event time is unknown because it is not observed.
<ul>
<li>This is easier to deal with, and what most statistical models we will talk about assume</li>
</ul>
</li>
</ul></section><section id="left-censoring" class="level4"><h4 class="anchored" data-anchor-id="left-censoring">Left censoring</h4>
<ul>
<li>An event time is unknown because it occurred prior to the beginning of data collection, but not when
<ul>
<li>This is difficult to deal with</li>
</ul>
</li>
</ul></section><section id="interval-censoring" class="level4"><h4 class="anchored" data-anchor-id="interval-censoring">Interval censoring</h4>
<ul>
<li>The event time is known to have occurred within a period of time, but it is unknown exactly when
<ul>
<li>This can be dealt with</li>
</ul>
</li>
</ul></section></section><section id="time-scales" class="level2"><h2 class="anchored" data-anchor-id="time-scales">Time Scales</h2>
<ul>
<li>Continuous time
<ul>
<li>Time is measured in very precise, unique increments &gt; miles until a tire blows out</li>
<li>Each observed duration is unique</li>
</ul>
</li>
<li>Discrete time
<ul>
<li>Time is measured in discrete lumps &gt; semester a student leaves college</li>
<li>Each observed duration is not necessarily unique, and takes one of a set of discrete values</li>
</ul>
</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/timescales.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Time Scales</figcaption><p></p>
</figure>
</div>
<section id="making-continuous-outcomes-discrete" class="level4"><h4 class="anchored" data-anchor-id="making-continuous-outcomes-discrete">Making continuous outcomes discrete</h4>
<ul>
<li><p>Ideally you should measure the duration as finely as possible (see Freedman et al)</p></li>
<li><p>Often you may choose to discretize the data &gt; take continuous time and break it into discrete chunks</p></li>
<li>
<p>Problems</p>
<ul>
<li>This removes possibly informative information on duration variability</li>
<li>Any discrete dividing point is arbitrary</li>
<li>You may arrive at different conclusions given the interval you choose</li>
<li>You lose information about late event occurrence</li>
<li>Lose all information on mean or average duration</li>
</ul>
</li>
</ul></section></section><section id="kinds-of-studies-with-event-history-data" class="level2"><h2 class="anchored" data-anchor-id="kinds-of-studies-with-event-history-data">Kinds of studies with event history data</h2>
<ul>
<li>
<p>Cross sectional</p>
<ul>
<li>Measured at one time point (no change observed)</li>
<li>Can measure lots of things at once</li>
<li>Retrospective designs are often used, e.g.&nbsp;the DHS and NSFG use retrospective fertility surveys
<ul>
<li><p>Ask respondents about events that have previously occurred.</p></li>
<li><p>Generate birth/migration/marital histories for individuals</p></li>
<li><p>Problems with recall bias</p></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Panel data</p>
<ul>
<li>Multiple measurements at discrete time points on the same individuals</li>
<li>Can look at change over time</li>
<li>Panels are often short in time, and involve a mixture of new and old respondents</li>
</ul>
</li>
<li>
<p>Longitudinal designs</p>
<ul>
<li>Continuous measurement of units over a fixed period of time, focusing on change in states</li>
<li>Think clinical follow-ups</li>
</ul>
</li>
<li>
<p>Prospective designs</p>
<ul>
<li>Studies that follow a group (cohort) and follow them over time</li>
<li>Expensive and take a long time, but can lead to extremely valuable information on changes in behaviors</li>
</ul>
</li>
<li>
<p>Record linkage procedures</p>
<ul>
<li>Begin with an event of interest (birth, marriage) and follow individuals using various record types</li>
<li>Birth &gt; Census 1880 &gt; Census 1890 &gt; Marriage &gt; Birth of children &gt; Census 1900 &gt; Tax records &gt;Death certificate</li>
<li>Mostly used in historical studies</li>
<li>Modern studies link health surveys to National Death Index (NHANES, NHIS)</li>
</ul>
</li>
</ul></section><section id="some-arrangements-for-event-history-data" class="level2"><h2 class="anchored" data-anchor-id="some-arrangements-for-event-history-data">Some arrangements for event history data</h2>
<section id="counting-process-data" class="level3"><h3 class="anchored" data-anchor-id="counting-process-data">Counting process data</h3>
<ul>
<li>This is what we are accustomed to in the life table, and your observations are typically aggregated into risk groups, for the life table these are age groups. Once your groups are identified, you count the number of observations experiencing the event of interest in that age group</li>
</ul>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Age_start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>               Age_end<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>               Failing<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">15</span>,<span class="fl">12</span>,<span class="fl">20</span><span class="op">)</span>,</span>
<span>               At_Risk<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">75</span>, <span class="fl">60</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">t1</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">column_spec</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, border_left <span class="op">=</span> <span class="cn">T</span>, border_right <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="tbl-cpdat" class="anchored">

<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>Table 1:  Counting Process Data </caption>
 <thead><tr>
<th style="text-align:right;"> Age_start </th>
   <th style="text-align:right;"> Age_end </th>
   <th style="text-align:right;"> Failing </th>
   <th style="text-align:right;"> At_Risk </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 25 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 100 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 15 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 75 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 12 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 60 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 5 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 20 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 40 </td>
  </tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="case---duration-or-person-level-data" class="level3"><h3 class="anchored" data-anchor-id="case---duration-or-person-level-data">Case - duration, or person level data</h3>
<ul>
<li>This is the general form of continuous time survival data.</li>
</ul>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>,</span>
<span>               Duration<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">9</span> , <span class="fl">6</span><span class="op">)</span>, </span>
<span>               Event_Occurred<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Yes (1)"</span>,<span class="st">"Yes (1)"</span>,<span class="st">"No (0)"</span>, <span class="st">"Yes (1)"</span> <span class="op">)</span><span class="op">)</span></span>
<span><span class="va">t2</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">column_spec</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, border_left <span class="op">=</span> <span class="cn">T</span>, border_right <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span>row_label_position <span class="op">=</span> <span class="st">"c"</span>, position <span class="op">=</span> <span class="st">"center"</span> <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;"> ID </th>
   <th style="text-align:right;"> Duration </th>
   <th style="text-align:left;"> Event_Occurred </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 5 </td>
   <td style="text-align:left;border-left:1px solid;border-right:1px solid;"> Yes (1) </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:left;border-left:1px solid;border-right:1px solid;"> Yes (1) </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 9 </td>
   <td style="text-align:left;border-left:1px solid;border-right:1px solid;"> No (0) </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 6 </td>
   <td style="text-align:left;border-left:1px solid;border-right:1px solid;"> Yes (1) </td>
  </tr>
</tbody>
</table>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#knitr::kable(t2, format = "html", caption = "Case-duration data", align = "c")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This can be transformed into person-period data, or discrete time data.</p>
</section><section id="person-period-data" class="level3"><h3 class="anchored" data-anchor-id="person-period-data">Person – Period data</h3>
<ul>
<li>Express exposure as discrete periods</li>
<li>Event occurrence is coded at each period</li>
</ul>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">t3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ID<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    Period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    Event<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">t3</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">column_spec</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, border_left <span class="op">=</span> <span class="cn">T</span>, border_right <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">%&gt;%</span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span>row_label_position <span class="op">=</span> <span class="st">"c"</span>, position <span class="op">=</span> <span class="st">"center"</span> <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;"> ID </th>
   <th style="text-align:right;"> Period </th>
   <th style="text-align:right;"> Event </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 5 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 5 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 6 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 7 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 8 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 9 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 1 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 2 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 3 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 5 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 4 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 6 </td>
   <td style="text-align:right;border-left:1px solid;border-right:1px solid;"> 0 </td>
  </tr>
</tbody>
</table>
</div>
</div>
</section></section></section><section id="functions-of-survival-time" class="level1"><h1>Functions of Survival Time</h1>
<section id="homage-to-the-life-table" class="level2"><h2 class="anchored" data-anchor-id="homage-to-the-life-table">Homage to the life table</h2>
<p>In life tables, we had lots of functions of the death process. Some of these were more interesting than others, with two being of special interest to use here.</p>
<p>These are the <span class="math inline">\(l(x)\)</span> and <span class="math inline">\(q(x, n)\)</span> functions.</p>
<p>If you recall, <span class="math inline">\(l(x)\)</span> represents the population size of the stationary population that is alive at age <span class="math inline">\(x\)</span>, and the risk of dying between age <span class="math inline">\(x, x+n\)</span> is <span class="math inline">\(q(x, n)\)</span>.</p>
<p>If you want to see a relatively current US life table, <a href="https://www.cdc.gov/nchs/data/nvsr/nvsr70/nvsr70-19.pdf">look here</a></p>
<p>Here is the life table through age 34 for the US in 2019:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/paste-5BEDAD3C.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">US Life table in 2019 through age 34</figcaption><p></p>
</figure>
</div>
</section><section id="life-tables-and-event-history-analysis" class="level2"><h2 class="anchored" data-anchor-id="life-tables-and-event-history-analysis">Life tables and Event History Analysis</h2>
<p>Once you start trying to apply life table types of analysis to survey data, the more generalized <strong>event history</strong> <strong>analysis</strong> body of methods quickly become the first choice. We can still describe the distribution of survival time using similar functions as in the life table.</p>
<p>The core event history or <strong>Survival analysis</strong> functions are the <strong>Survival Function</strong>, <span class="math inline">\(S(t)\)</span>, the <strong>hazard function</strong>, <span class="math inline">\(h(t)\)</span> and the <strong>probability density function</strong>, <span class="math inline">\(f(t)\)</span>, The first two are the same as the <span class="math inline">\(l(x)\)</span> and <span class="math inline">\(q(x, n)\)</span> functions, and the third centers these methods in probability theory. These three are related and we can derive one from the others.</p>
<p>Now we must generalize these ideas to incorporate them into the broader event-history framework</p>
<p>Survival/duration times measure the <em><strong>time to a certain event</strong>.</em></p>
<p>These times are subject to random variations, and are considered to be random <em>iid</em> (independent and identically distributed; random) variates from some distribution</p>
<p>The distribution of survival times is described by 3 functions</p>
<ul>
<li>The survivorship function, <span class="math inline">\(S(t)\)</span>
</li>
<li>The probability density function, <span class="math inline">\(f(t)\)</span>
</li>
<li>The hazard function, <span class="math inline">\(h(t)\)</span>
</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/functions.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Survival and Hazard Functions</figcaption><p></p>
</figure>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">Ft</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html">dlnorm</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">110</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                  meanlog <span class="op">=</span> <span class="fl">4.317488</span>,</span>
<span>                  sdlog <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span> <span class="co">#mean of 75 years, sd of 12.1 years</span></span>
<span><span class="va">ft</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">Ft</span><span class="op">)</span></span>
<span><span class="va">St</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">-</span><span class="va">Ft</span></span>
<span><span class="va">ht</span><span class="op">&lt;-</span><span class="va">ft</span><span class="op">/</span><span class="va">St</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">110</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Ft</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, type<span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">St</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">ht</span>, col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="EX1_ModelData_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ul>
<li>These three are mathematically related, and if given one, we can calculate the others
<ul>
<li>These 3 functions each represent a different aspect of the survival time distribution.</li>
</ul>
</li>
<li>The fundamental problem in survival analysis is coming up with a way to estimate these functions.</li>
</ul>
<section id="defining-the-functions" class="level3"><h3 class="anchored" data-anchor-id="defining-the-functions">Defining the functions</h3>
<p>Let <span class="math inline">\(T\)</span> denote the survival time, our goal is to characterize the distribution of <span class="math inline">\(T\)</span> using these 3 functions.</p>
<p>Let <span class="math inline">\(T\)</span> be a discrete(or continuous) <em>iid</em> random variable and let <span class="math inline">\(t_i\)</span>, be an occurrence of that variable, such that <span class="math inline">\(Pr(t_i)=Pr(T=t_i)\)</span></p>
</section><section id="the-distribution-function-or-pdf" class="level3"><h3 class="anchored" data-anchor-id="the-distribution-function-or-pdf">The distribution function, or <em>pdf</em>
</h3>
<p>Like any other random variates survival times have a simple distribution function that gives the probability of observing a particular survival time within a finite interval</p>
<p>The density function is defined as the limit of the probability that an individual fails (experiences the event) in a short interval <span class="math inline">\(t+\Delta t\)</span> (read delta t), per width of <span class="math inline">\(\Delta t\)</span>, or simply the probability of failure in a small interval per unit time, <span class="math inline">\(f(t_i) = Pr(T=t_i)\)</span>.</p>
<p>If <span class="math inline">\(F(t)\)</span> is the cumulative distribution function for <em>T</em>, given by:</p>
<p><span id="eq-1"><span class="math display">\[ F(t) = \int_{0}^{t} f(u) du = Pr(T \leqslant t ) \tag{1}\]</span></span> Which is the probability of observing a value of <em>T</em> prior to the current value, <em>t</em>.</p>
<p>The density function is then:</p>
<p><span id="eq-2"><span class="math display">\[ f(t) = \frac{F(t)}{d(t)} = F'(t) \tag{2}\]</span></span> or</p>
<p><span id="eq-3"><span class="math display">\[ f(t) = \lim_{\delta t \rightarrow 0} \frac{F(t+\Delta t) - F(t)}{\Delta t} \tag{3}\]</span></span></p>
<p>The density function gives the unconditional instantaneous failure rate in the (very small) interval between <em>t</em> and <em>dt</em>, <span class="math inline">\(\Delta t\)</span></p>
</section><section id="survival-function" class="level3"><h3 class="anchored" data-anchor-id="survival-function">Survival Function</h3>
<p>The survival function, <em>S(t)</em> is expressed:</p>
<p><span id="eq-4"><span class="math display">\[ S(t) = 1 - F(t) = Pr (T \geqslant t) \tag{4}\]</span></span></p>
<p>Which is the probability that <em>T</em> takes a value larger than <em>t</em>. i.e.&nbsp;the event happens some time after the present time.</p>
<p>At <span class="math inline">\(t = 0, S(t) =1 \text { and at } t= \infty, \text { and } S(t) =0\)</span></p>
<p>As time passes, <span class="math inline">\(S(t)\)</span> decreases, and is called a <em>strictly decreasing function of time</em>.</p>
<p>Empirically, <span class="math inline">\(S(t)\)</span> takes the form of a step function:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">St</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumprod</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="va">t1</span><span class="op">$</span><span class="va">Failing</span><span class="op">/</span><span class="va">t1</span><span class="op">$</span><span class="va">At_Risk</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">St</span>, type<span class="op">=</span><span class="st">"s"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"S(t)"</span>,</span>
<span>     ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="EX1_ModelData_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
</section><section id="the-hazard-function" class="level3"><h3 class="anchored" data-anchor-id="the-hazard-function">The hazard function</h3>
<p>The hazard function relates death, <em>f(t)</em>, and survival, <em>S(t)</em>, to one another</p>
<p><span id="eq-5"><span class="math display">\[h(t) = \frac{f(t)}{S(t)} \tag{5}\]</span></span> <span id="eq-6"><span class="math display">\[h(t) = \lim_{\Delta t \rightarrow 0} \frac{Pr(t \leqslant T \leqslant t + \Delta t | T \geqslant t)}{\Delta t} \tag{6}\]</span></span></p>
<p>Which is the failure rate per unit time in the interval <em>t</em>, <span class="math inline">\(t+\Delta t\)</span>, the hazard may increase or decrease with time, or stay the same. This is really dependent on the distribution of failure times.</p>
</section></section><section id="relationships-among-the-three-functions" class="level2"><h2 class="anchored" data-anchor-id="relationships-among-the-three-functions">Relationships among the three functions</h2>
<p>If <span class="math inline">\(ft = \frac{dF(t)}{dt}\)</span> and <span class="math inline">\(S(t) = 1- F(t)\)</span> and, <span class="math inline">\(h(t) = \frac{f(t)}{S(t)}\)</span>, then we can write:</p>
<p><span id="eq-7"><span class="math display">\[f(t) = \frac{-dS(t)}{dt} \tag{7}\]</span></span></p>
<p>and the hazard function as:</p>
<p><span id="eq-8"><span class="math display">\[h(t) = \frac{-d \text{ log } S(t)}{dt} \tag{8}\]</span></span></p>
<p>If we integrate this and let <span class="math inline">\(S(0)=1\)</span>, then</p>
<p><span id="eq-9"><span class="math display">\[S(t) = exp^{-\int_{0}^t h(u) du} = e^{-H(t)} \tag{9}\]</span></span></p>
<p>where the quantity, <span class="math inline">\(H(t)\)</span> is called the <em>cumulative hazard function</em> and,</p>
<p><span class="math inline">\(H(t) = \int h(u) du\)</span></p>
<p>, then</p>
<p><span id="eq-10"><span class="math display">\[H(t) = -\text{log }  S(t) \tag{10}\]</span></span></p>
<p>The density can be written as:</p>
<p><span id="eq-11"><span class="math display">\[f(t) = h(t) e ^{-H(t)} \tag{11}\]</span></span> and</p>
<p><span id="eq-12"><span class="math display">\[h(t) = \frac{h(t) e^{-H(t)}}{e^{-H(t)}} = \frac{f(t)}{S(t)} \tag{12}\]</span></span></p>
<section id="more-on-the-hazard-function" class="level3"><h3 class="anchored" data-anchor-id="more-on-the-hazard-function">More on the hazard function…</h3>
<p>Unlike the <em>f(t)</em> or <em>S(t)</em>, <em>h(t)</em> describes the risk an individual faces of experiencing the event, given they have survived up to that time.</p>
<p>This kind of conditional probability is of special interest to us.</p>
<p>We can extend this framework to include effects of <em>individual characteristics on one’s risk</em>, thus not only introducing dependence on time, but also on these characteristics (covariates).</p>
<p>We can re-express the hazard rate with both these conditions as:</p>
<p><span id="eq-13"><span class="math display">\[h(t|x) = \lim_{\Delta t \rightarrow 0} \frac{Pr(t \leqslant T \leqslant t + \Delta t | T \geqslant t, x)}{\Delta t} \tag{13}\]</span></span></p>
</section></section><section id="example-from-data" class="level2"><h2 class="anchored" data-anchor-id="example-from-data">Example from data</h2>
<p>This example will illustrate how to construct a basic survival function from individual-level data. The example will use as its outcome variable, the event of a child dying before age 1. The data for this example come from the <a href="http://dhsprogram.com/data/Download-Model-Datasets.cfm?flag=1">Demographic and Health Survey Model Data Files</a> children’s recode file.</p>
<p>The DHS Program has created example data sets for users to practice with. These data sets have been created strictly for practice and do not represent any actual country’s data. See more <a href="http://dhsprogram.com/data/Download-Model-Datasets.cfm?flag=1#sthash.HRINGQ00.dpuf">here</a>.</p>
<p>This file contains information for all births to the sample of women between the ages of 15 and 49 in the last 5 years prior to the survey.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival">survival</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">model.dat</span><span class="op">&lt;-</span><span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html">read_dta</a></span><span class="op">(</span><span class="st">"https://github.com/coreysparks/data/blob/master/ZZKR62FL.DTA?raw=true"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="event---infant-mortality" class="level2"><h2 class="anchored" data-anchor-id="event---infant-mortality">Event - Infant Mortality</h2>
<p>In the DHS, they record if a child is dead or alive and the age at death if the child is dead. This can be understood using a series of variables about each child.</p>
<p>If the child is alive at the time of interview, then the variable B5==1, and the age at death is censored.</p>
<p>If the age at death is censored, then the age at the date of interview (censored age at death) is the date of the interview - date of birth (in months).</p>
<p>If the child is dead at the time of interview,then the variable B5!=1, then the age at death in months is the variable B7. Here we code this:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org">forcats</a></span><span class="op">)</span></span>
<span><span class="va">model.dat</span><span class="op">&lt;-</span> <span class="va">model.dat</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>death.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">b5</span><span class="op">==</span><span class="fl">1</span>,</span>
<span>                          <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">v008</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1900</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">b3</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1900</span><span class="op">)</span><span class="op">)</span> </span>
<span>                          ,<span class="va">b7</span><span class="op">)</span>, </span>
<span><span class="co">#censoring indicator for death by age 1, in months (12 months)</span></span>
<span>          d.event <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">b7</span><span class="op">)</span><span class="op">==</span><span class="cn">T</span><span class="op">|</span><span class="va">b7</span><span class="op">&gt;</span><span class="fl">12</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, </span>
<span>          d.eventfac <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">d.event</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Alive at 1"</span>, <span class="st">"Dead by 1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">model.dat</span><span class="op">$</span><span class="va">d.eventfac</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Alive at 1  Dead by 1 
      5434        534 </code></pre>
</div>
</div>
<p>We see 534 infant deaths among the 5968 births in the last 5 years.</p>
</section><section id="example-of-estimating-survival-time-functions-from-data" class="level2"><h2 class="anchored" data-anchor-id="example-of-estimating-survival-time-functions-from-data">Example of Estimating Survival Time Functions from data</h2>
<p>To generate a basic life table, we use the <code><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit()</a></code> procedure in the <code>survival</code> library. The data for this is a <code><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv()</a></code> object, which typically has 2 arguments, the duration, and the censoring indicator. This uses age at death (the <code>death.age</code> variable from above) for children dying before age 1 as the outcome, and the <code>d.event</code> variable from above as the censoring indicator.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">model.dat</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"death.age"</span>,<span class="st">"d.event"</span><span class="op">)</span><span class="op">]</span>, n<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<table>
<thead><tr>
<th style="text-align:right;"> death.age </th>
   <th style="text-align:right;"> d.event </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 37 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 30 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 30 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
<tr>
<td style="text-align:right;"> 34 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
<tr>
<td style="text-align:right;"> 18 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
<tr>
<td style="text-align:right;"> 27 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 24 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 12 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 9 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 1 </td>
  </tr>
<tr>
<td style="text-align:right;"> 54 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 16 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 37 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 30 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">model.dat</span><span class="op">$</span><span class="va">death.age</span>, <span class="va">model.dat</span><span class="op">$</span><span class="va">d.event</span><span class="op">)</span>, n<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> [1]  5+ 37+ 30+ 10+ 30+  0  34+  1  18+  3  27+ 24+ 12+  9+  5  54+ 16+ 37+ 30+
[20]  0+</code></pre>
</div>
</div>
<p>In the first 20 cases from the data, several children died (no <code>+</code> after the time), while all the other children had not experienced the event (they were still alive at age 12 months), these have a <code>+</code> after their censored age at death.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mort</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">death.age</span>, <span class="va">d.event</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span>,</span>
<span>              data<span class="op">=</span><span class="va">model.dat</span>,</span>
<span>              conf.type<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mort</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.9</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>     xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span><span class="op">)</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Survival Function for Infant Mortality"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="EX1_ModelData_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="768"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mort</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Call: survfit(formula = Surv(death.age, d.event) ~ 1, data = model.dat, 
    conf.type = "none")

 time n.risk n.event survival std.err
    0   5968     209    0.965 0.00238
    1   5690      26    0.961 0.00252
    2   5573      37    0.954 0.00271
    3   5423      38    0.948 0.00290
    4   5282      25    0.943 0.00302
    5   5161      22    0.939 0.00313
    6   5021      26    0.934 0.00326
    7   4880      18    0.931 0.00334
    8   4755      26    0.926 0.00347
    9   4621      23    0.921 0.00359
   10   4507       5    0.920 0.00361
   11   4405      13    0.917 0.00368
   12   4303      66    0.903 0.00401</code></pre>
</div>
</div>
<p>This is the so-called Kaplan-Meier estimate of the survival function. At each month, we see the number of children at risk and the number dying. We see the highest number of deaths occurred between 0 and 1 month, which is not surprising.</p>
<p>The estimate is that the infant morality rate is 82.7382814 , I get this by doing <code>1000*(1-summary(mort)$surv[12])</code>.</p>
<p>We can likewise get an estimate of the hazard function using the Kaplan-Meier method as well, using the <code>muhaz</code> library.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">muhaz</span><span class="op">)</span></span>
<span></span>
<span><span class="va">haz</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/muhaz/man/kphaz.fit.html">kphaz.fit</a></span><span class="op">(</span>time<span class="op">=</span><span class="va">model.dat</span><span class="op">$</span><span class="va">death.age</span>, </span>
<span>               status<span class="op">=</span><span class="va">model.dat</span><span class="op">$</span><span class="va">d.event</span>,</span>
<span>               method <span class="op">=</span> <span class="st">"product-limit"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/muhaz/man/kphaz.plot.html">kphaz.plot</a></span><span class="op">(</span><span class="va">haz</span>,</span>
<span>           main<span class="op">=</span><span class="st">"Hazard function plot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="EX1_ModelData_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="768"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">haz</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["time"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["haz"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["var"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.5","2":"0.004617002","3":"8.198994e-07"},{"1":"1.5","2":"0.006722906","3":"1.221621e-06"},{"1":"2.5","2":"0.007109508","3":"1.330224e-06"},{"1":"3.5","2":"0.004784710","3":"9.157877e-07"},{"1":"4.5","2":"0.004326655","3":"8.509621e-07"},{"1":"5.5","2":"0.005244306","3":"1.057883e-06"},{"1":"6.5","2":"0.003732925","3":"7.741945e-07"},{"1":"7.5","2":"0.005545073","3":"1.182716e-06"},{"1":"8.5","2":"0.005037790","3":"1.103514e-06"},{"1":"9.5","2":"0.001118111","3":"2.500496e-07"},{"1":"10.5","2":"0.002993934","3":"6.895473e-07"},{"1":"11.5","2":"0.015646925","3":"3.709910e-06"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This illustrates, that while the largest drop in survivorship occurred between 0 and 1, the hazard is actually higher in the 1-3 month range, illustrating the conditional nature of that probability. There is also a large jump in risk at age 1, which may indicate something about age-heaping in the data.</p>
<p>Now we have our <span class="math inline">\(S(t)\)</span> and <span class="math inline">\(h(t)\)</span> functions. We can derive the other functions of survival time from these but integrating (summing) and differentiating these functions.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#cumulative hazard</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">haz</span><span class="op">$</span><span class="va">haz</span><span class="op">)</span><span class="op">~</span><span class="va">haz</span><span class="op">$</span><span class="va">time</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Cumulative Hazard function"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"H(t)"</span>,xlab<span class="op">=</span><span class="st">"Time in Months"</span>, </span>
<span>     type<span class="op">=</span><span class="st">"l"</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">12</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="EX1_ModelData_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="768"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Survival function, I just store this in an object so I can use it</span></span>
<span><span class="va">surv</span><span class="op">&lt;-</span><span class="va">mort</span></span>
<span></span>
<span><span class="co">#here is a cheap version of the pdf</span></span>
<span><span class="va">ft</span><span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">mort</span><span class="op">$</span><span class="va">surv</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ft</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">11.5</span><span class="op">)</span>, </span>
<span>     type<span class="op">=</span><span class="st">"s"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"f(t)"</span>,xlab<span class="op">=</span><span class="st">"Time in Months"</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Probability Density Function"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="EX1_ModelData_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="768"></p>
</div>
<details><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#here is the cumulative distribution function</span></span>
<span><span class="va">Ft</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">ft</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Ft</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">12</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"s"</span>, ylab<span class="op">=</span><span class="st">"F(t)"</span>,xlab<span class="op">=</span><span class="st">"Time in Months"</span>, main<span class="op">=</span><span class="st">"Cumulative Distribution Function"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="EX1_ModelData_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>So in this example, we calculated the censored ages at death for children under age 1, we estimated the survival function, hazard and Cumulative hazard functions, and the associated pdf and cdf’s.</p>
<!-- -->

</section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb21" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "DEM 7223 - Introduction to Event History Analysis and Functions of Survival Time"</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "[Corey S. Sparks, PhD](https://coreysparks.github.io)"</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: "[The University of Texas at San Antonio](https://hcap.utsa.edu/demography)"</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%d %B, %Y')`"</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    html:</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">      code-fold: true</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">      code-tools: true</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">      code-link: true</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">      df-print: paged</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">      toc: true</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> visual</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, message=FALSE}</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="fu"># Rational for Event history analysis</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="fu">### When to conduct an event history analysis?</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>When you questions include</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When or Whether</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>When <span class="sc">\&gt;</span> how long until an event occurs</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Whether <span class="sc">\&gt;</span> does an event occur or not</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If your question does not include either of these ideas (or cannot be made to) then you do not need to do event history analysis</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="fu">### Basic Propositions</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Since most of the methods we will discuss originate from studies of mortality, they have morbid names</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Survival -- This is related to how long a case lasts until it experiences the event of interest</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>How long does it take?</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Risk -- How likely is it that the case will experience the event</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Will it happen or not?</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="fu">### Focus on comparison</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Most of the methods we consider are comparative by their nature</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How long does a case with trait x survive, compared to a case with trait y?</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How likely is it for a person who is married to die of homicide relative to someone who is single?</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Generally we are examining relative risk and relative survival</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="fu">### Some terminology</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>It is important to establish some key vocabulary we will use throughout the course. These terms are essential to our modeling and thinking about structuring our data and measuring our outcomes. We will use a simple example of the time to first birth to illustrate.</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**State** -- discrete condition an individual may occupy that occur within a state space. Most survival analysis methods assume a single state to state transition.</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g. for our example the two states would be: Childless and having 1 child born</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**State space** -- full set of state alternatives</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g. the two states would be: Childless and having 1 child born</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Episodes/Events/Transitions** -- a change in states</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The transition would be having a first child. The event would be coded as 0/1 based on whether a woman has had a fist child or not</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Durations** -- length of an episode</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The duration here would be the length of time between the start of the risk (for this outcome, it's typically marriage) and the time of the first birth.</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Time axis** -- Metric for measuring durations (days, months, years)</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Time could be measured in days, weeks, months, or even years.</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a><span class="al">![State Space Illustration](images/state_concepts.png)</span></span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a><span class="fu">### Issues in event history data</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Censoring</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Censoring** occurs when you do not actually observe the event of interest within the period of data collection</span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g. you know someone gets married, but you never observe them having a child</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>e.g. someone leaves alcohol treatment and is never observed drinking again</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="al">![Censoring](images/censoring.png)</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Non-informative censoring</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The individual is not observed because the observer ends the study period</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The censoring is not related to any trait or action of the case, but related to the observer</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We want most of our censoring to be this kind</span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Informative censoring</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The individual is not observed because they represent a special case</span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The censoring IS related to something about the individual, and these people differ inherently from uncensored cases</span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>People that are censored ARE likely to have experience the event</span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Right censoring</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>An event time is unknown because it is not observed.</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This is easier to deal with, and what most statistical models we will talk about assume</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Left censoring</span></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>An event time is unknown because it occurred prior to the beginning of data collection, but not when</span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This is difficult to deal with</span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interval censoring</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The event time is known to have occurred within a period of time, but it is unknown exactly when</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This can be dealt with</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time Scales</span></span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Continuous time</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Time is measured in very precise, unique increments <span class="sc">\&gt;</span> miles until a tire blows out</span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Each observed duration is unique</span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Discrete time</span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Time is measured in discrete lumps <span class="sc">\&gt;</span> semester a student leaves college</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Each observed duration is not necessarily unique, and takes one of a set of discrete values</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a><span class="al">![Time Scales](images/timescales.png)</span></span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Making continuous outcomes discrete</span></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ideally you should measure the duration as finely as possible (see Freedman et al)</span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Often you may choose to discretize the data <span class="sc">\&gt;</span> take continuous time and break it into discrete chunks</span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Problems</span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>This removes possibly informative information on duration variability</span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Any discrete dividing point is arbitrary</span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>You may arrive at different conclusions given the interval you choose</span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>You lose information about late event occurrence</span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Lose all information on mean or average duration</span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a><span class="fu">## Kinds of studies with event history data</span></span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cross sectional</span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Measured at one time point (no change observed)</span>
<span id="cb21-133"><a href="#cb21-133" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can measure lots of things at once</span>
<span id="cb21-134"><a href="#cb21-134" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Retrospective designs are often used, e.g. the DHS and NSFG use retrospective fertility surveys</span>
<span id="cb21-135"><a href="#cb21-135" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Ask respondents about events that have previously occurred.</span>
<span id="cb21-136"><a href="#cb21-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-137"><a href="#cb21-137" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Generate birth/migration/marital histories for individuals</span>
<span id="cb21-138"><a href="#cb21-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-139"><a href="#cb21-139" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>Problems with recall bias</span>
<span id="cb21-140"><a href="#cb21-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-141"><a href="#cb21-141" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Panel data</span>
<span id="cb21-142"><a href="#cb21-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-143"><a href="#cb21-143" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Multiple measurements at discrete time points on the same individuals</span>
<span id="cb21-144"><a href="#cb21-144" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Can look at change over time</span>
<span id="cb21-145"><a href="#cb21-145" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Panels are often short in time, and involve a mixture of new and old respondents</span>
<span id="cb21-146"><a href="#cb21-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-147"><a href="#cb21-147" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Longitudinal designs</span>
<span id="cb21-148"><a href="#cb21-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-149"><a href="#cb21-149" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Continuous measurement of units over a fixed period of time, focusing on change in states</span>
<span id="cb21-150"><a href="#cb21-150" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Think clinical follow-ups</span>
<span id="cb21-151"><a href="#cb21-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-152"><a href="#cb21-152" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Prospective designs</span>
<span id="cb21-153"><a href="#cb21-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-154"><a href="#cb21-154" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Studies that follow a group (cohort) and follow them over time</span>
<span id="cb21-155"><a href="#cb21-155" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Expensive and take a long time, but can lead to extremely valuable information on changes in behaviors</span>
<span id="cb21-156"><a href="#cb21-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-157"><a href="#cb21-157" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Record linkage procedures</span>
<span id="cb21-158"><a href="#cb21-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-159"><a href="#cb21-159" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Begin with an event of interest (birth, marriage) and follow individuals using various record types</span>
<span id="cb21-160"><a href="#cb21-160" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Birth <span class="sc">\&gt;</span> Census 1880 <span class="sc">\&gt;</span> Census 1890 <span class="sc">\&gt;</span> Marriage <span class="sc">\&gt;</span> Birth of children <span class="sc">\&gt;</span> Census 1900 <span class="sc">\&gt;</span> Tax records <span class="sc">\&gt;</span>Death certificate</span>
<span id="cb21-161"><a href="#cb21-161" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Mostly used in historical studies</span>
<span id="cb21-162"><a href="#cb21-162" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Modern studies link health surveys to National Death Index (NHANES, NHIS)</span>
<span id="cb21-163"><a href="#cb21-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-164"><a href="#cb21-164" aria-hidden="true" tabindex="-1"></a><span class="fu">## Some arrangements for event history data</span></span>
<span id="cb21-165"><a href="#cb21-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-166"><a href="#cb21-166" aria-hidden="true" tabindex="-1"></a><span class="fu">### Counting process data</span></span>
<span id="cb21-167"><a href="#cb21-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-168"><a href="#cb21-168" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is what we are accustomed to in the life table, and your observations are typically aggregated into risk groups, for the life table these are age groups. Once your groups are identified, you count the number of observations experiencing the event of interest in that age group</span>
<span id="cb21-169"><a href="#cb21-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-172"><a href="#cb21-172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-173"><a href="#cb21-173" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-cpdat</span></span>
<span id="cb21-174"><a href="#cb21-174" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb21-175"><a href="#cb21-175" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Counting Process Data"</span></span>
<span id="cb21-176"><a href="#cb21-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-177"><a href="#cb21-177" aria-hidden="true" tabindex="-1"></a>t1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Age_start=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb21-178"><a href="#cb21-178" aria-hidden="true" tabindex="-1"></a>               <span class="at">Age_end=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),</span>
<span id="cb21-179"><a href="#cb21-179" aria-hidden="true" tabindex="-1"></a>               <span class="at">Failing=</span><span class="fu">c</span>(<span class="dv">25</span>,<span class="dv">15</span>,<span class="dv">12</span>,<span class="dv">20</span>),</span>
<span id="cb21-180"><a href="#cb21-180" aria-hidden="true" tabindex="-1"></a>               <span class="at">At_Risk=</span><span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">75</span>, <span class="dv">60</span>, <span class="dv">40</span>))</span>
<span id="cb21-181"><a href="#cb21-181" aria-hidden="true" tabindex="-1"></a>t1<span class="sc">%&gt;%</span></span>
<span id="cb21-182"><a href="#cb21-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()<span class="sc">%&gt;%</span></span>
<span id="cb21-183"><a href="#cb21-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">border_left =</span> T, <span class="at">border_right =</span> T)<span class="sc">%&gt;%</span></span>
<span id="cb21-184"><a href="#cb21-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span>
<span id="cb21-185"><a href="#cb21-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-186"><a href="#cb21-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-187"><a href="#cb21-187" aria-hidden="true" tabindex="-1"></a><span class="fu">### Case - duration, or person level data</span></span>
<span id="cb21-188"><a href="#cb21-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-189"><a href="#cb21-189" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>This is the general form of continuous time survival data.</span>
<span id="cb21-190"><a href="#cb21-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-193"><a href="#cb21-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-194"><a href="#cb21-194" aria-hidden="true" tabindex="-1"></a>t2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb21-195"><a href="#cb21-195" aria-hidden="true" tabindex="-1"></a>               <span class="at">Duration=</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">9</span> , <span class="dv">6</span>), </span>
<span id="cb21-196"><a href="#cb21-196" aria-hidden="true" tabindex="-1"></a>               <span class="at">Event_Occurred=</span><span class="fu">c</span>(<span class="st">"Yes (1)"</span>,<span class="st">"Yes (1)"</span>,<span class="st">"No (0)"</span>, <span class="st">"Yes (1)"</span> ))</span>
<span id="cb21-197"><a href="#cb21-197" aria-hidden="true" tabindex="-1"></a>t2<span class="sc">%&gt;%</span></span>
<span id="cb21-198"><a href="#cb21-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()<span class="sc">%&gt;%</span></span>
<span id="cb21-199"><a href="#cb21-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">border_left =</span> T, <span class="at">border_right =</span> T)<span class="sc">%&gt;%</span></span>
<span id="cb21-200"><a href="#cb21-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">row_label_position =</span> <span class="st">"c"</span>, <span class="at">position =</span> <span class="st">"center"</span> )</span>
<span id="cb21-201"><a href="#cb21-201" aria-hidden="true" tabindex="-1"></a><span class="co">#knitr::kable(t2, format = "html", caption = "Case-duration data", align = "c")</span></span>
<span id="cb21-202"><a href="#cb21-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-203"><a href="#cb21-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-204"><a href="#cb21-204" aria-hidden="true" tabindex="-1"></a>This can be transformed into person-period data, or discrete time data.</span>
<span id="cb21-205"><a href="#cb21-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-206"><a href="#cb21-206" aria-hidden="true" tabindex="-1"></a><span class="fu">### Person -- Period data</span></span>
<span id="cb21-207"><a href="#cb21-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-208"><a href="#cb21-208" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Express exposure as discrete periods</span>
<span id="cb21-209"><a href="#cb21-209" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Event occurrence is coded at each period</span>
<span id="cb21-210"><a href="#cb21-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-213"><a href="#cb21-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-214"><a href="#cb21-214" aria-hidden="true" tabindex="-1"></a>t3<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">ID=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="fu">rep</span>(<span class="dv">3</span>, <span class="dv">9</span>), <span class="fu">rep</span>(<span class="dv">4</span>, <span class="dv">6</span>)),</span>
<span id="cb21-215"><a href="#cb21-215" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Period =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>), <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)),</span>
<span id="cb21-216"><a href="#cb21-216" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Event=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb21-217"><a href="#cb21-217" aria-hidden="true" tabindex="-1"></a>t3<span class="sc">%&gt;%</span></span>
<span id="cb21-218"><a href="#cb21-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()<span class="sc">%&gt;%</span></span>
<span id="cb21-219"><a href="#cb21-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">border_left =</span> T, <span class="at">border_right =</span> T)<span class="sc">%&gt;%</span></span>
<span id="cb21-220"><a href="#cb21-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">row_label_position =</span> <span class="st">"c"</span>, <span class="at">position =</span> <span class="st">"center"</span> )</span>
<span id="cb21-221"><a href="#cb21-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-222"><a href="#cb21-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-223"><a href="#cb21-223" aria-hidden="true" tabindex="-1"></a><span class="fu"># Functions of Survival Time</span></span>
<span id="cb21-224"><a href="#cb21-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-225"><a href="#cb21-225" aria-hidden="true" tabindex="-1"></a><span class="fu">## Homage to the life table</span></span>
<span id="cb21-226"><a href="#cb21-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-227"><a href="#cb21-227" aria-hidden="true" tabindex="-1"></a>In life tables, we had lots of functions of the death process. Some of these were more interesting than others, with two being of special interest to use here.</span>
<span id="cb21-228"><a href="#cb21-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-229"><a href="#cb21-229" aria-hidden="true" tabindex="-1"></a>These are the $l(x)$ and $q(x, n)$ functions.</span>
<span id="cb21-230"><a href="#cb21-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-231"><a href="#cb21-231" aria-hidden="true" tabindex="-1"></a>If you recall, $l(x)$ represents the population size of the stationary population that is alive at age $x$, and the risk of dying between age $x, x+n$ is $q(x, n)$.</span>
<span id="cb21-232"><a href="#cb21-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-233"><a href="#cb21-233" aria-hidden="true" tabindex="-1"></a>If you want to see a relatively current US life table, <span class="co">[</span><span class="ot">look here</span><span class="co">](https://www.cdc.gov/nchs/data/nvsr/nvsr70/nvsr70-19.pdf)</span></span>
<span id="cb21-234"><a href="#cb21-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-235"><a href="#cb21-235" aria-hidden="true" tabindex="-1"></a>Here is the life table through age 34 for the US in 2019:</span>
<span id="cb21-236"><a href="#cb21-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-237"><a href="#cb21-237" aria-hidden="true" tabindex="-1"></a><span class="al">![US Life table in 2019 through age 34](images/paste-5BEDAD3C.png)</span>{fig-align="center"}</span>
<span id="cb21-238"><a href="#cb21-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-239"><a href="#cb21-239" aria-hidden="true" tabindex="-1"></a><span class="fu">## Life tables and Event History Analysis</span></span>
<span id="cb21-240"><a href="#cb21-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-241"><a href="#cb21-241" aria-hidden="true" tabindex="-1"></a>Once you start trying to apply life table types of analysis to survey data, the more generalized **event history** **analysis** body of methods quickly become the first choice. We can still describe the distribution of survival time using similar functions as in the life table.</span>
<span id="cb21-242"><a href="#cb21-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-243"><a href="#cb21-243" aria-hidden="true" tabindex="-1"></a>The core event history or **Survival analysis** functions are the **Survival Function**, $S(t)$, the **hazard function**, $h(t)$ and the **probability density function**, $f(t)$, The first two are the same as the $l(x)$ and $q(x, n)$ functions, and the third centers these methods in probability theory. These three are related and we can derive one from the others.</span>
<span id="cb21-244"><a href="#cb21-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-245"><a href="#cb21-245" aria-hidden="true" tabindex="-1"></a>Now we must generalize these ideas to incorporate them into the broader event-history framework</span>
<span id="cb21-246"><a href="#cb21-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-247"><a href="#cb21-247" aria-hidden="true" tabindex="-1"></a>Survival/duration times measure the ***time to a certain event**.*</span>
<span id="cb21-248"><a href="#cb21-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-249"><a href="#cb21-249" aria-hidden="true" tabindex="-1"></a>These times are subject to random variations, and are considered to be random *iid* (independent and identically distributed; random) variates from some distribution</span>
<span id="cb21-250"><a href="#cb21-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-251"><a href="#cb21-251" aria-hidden="true" tabindex="-1"></a>The distribution of survival times is described by 3 functions</span>
<span id="cb21-252"><a href="#cb21-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-253"><a href="#cb21-253" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The survivorship function, $S(t)$</span>
<span id="cb21-254"><a href="#cb21-254" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The probability density function, $f(t)$</span>
<span id="cb21-255"><a href="#cb21-255" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The hazard function, $h(t)$</span>
<span id="cb21-256"><a href="#cb21-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-257"><a href="#cb21-257" aria-hidden="true" tabindex="-1"></a><span class="al">![Survival and Hazard Functions](images/functions.png)</span></span>
<span id="cb21-258"><a href="#cb21-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-261"><a href="#cb21-261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-262"><a href="#cb21-262" aria-hidden="true" tabindex="-1"></a>Ft<span class="ot">&lt;-</span><span class="fu">cumsum</span>(<span class="fu">dlnorm</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">110</span>, <span class="dv">1</span>),</span>
<span id="cb21-263"><a href="#cb21-263" aria-hidden="true" tabindex="-1"></a>                  <span class="at">meanlog =</span> <span class="fl">4.317488</span>,</span>
<span id="cb21-264"><a href="#cb21-264" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sdlog =</span> <span class="fl">2.5</span>)) <span class="co">#mean of 75 years, sd of 12.1 years</span></span>
<span id="cb21-265"><a href="#cb21-265" aria-hidden="true" tabindex="-1"></a>ft<span class="ot">&lt;-</span><span class="fu">diff</span>(Ft)</span>
<span id="cb21-266"><a href="#cb21-266" aria-hidden="true" tabindex="-1"></a>St<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">-</span>Ft</span>
<span id="cb21-267"><a href="#cb21-267" aria-hidden="true" tabindex="-1"></a>ht<span class="ot">&lt;-</span>ft<span class="sc">/</span>St[<span class="dv">1</span><span class="sc">:</span><span class="dv">110</span>]</span>
<span id="cb21-268"><a href="#cb21-268" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Ft, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">type=</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"Time"</span>, <span class="at">ylab =</span> <span class="st">"Probability"</span>)</span>
<span id="cb21-269"><a href="#cb21-269" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(St, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb21-270"><a href="#cb21-270" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ht, <span class="at">col=</span><span class="st">"green"</span>)</span>
<span id="cb21-271"><a href="#cb21-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-272"><a href="#cb21-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-273"><a href="#cb21-273" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>These three are mathematically related, and if given one, we can calculate the others</span>
<span id="cb21-274"><a href="#cb21-274" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>These 3 functions each represent a different aspect of the survival time distribution.</span>
<span id="cb21-275"><a href="#cb21-275" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The fundamental problem in survival analysis is coming up with a way to estimate these functions.</span>
<span id="cb21-276"><a href="#cb21-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-277"><a href="#cb21-277" aria-hidden="true" tabindex="-1"></a><span class="fu">### Defining the functions</span></span>
<span id="cb21-278"><a href="#cb21-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-279"><a href="#cb21-279" aria-hidden="true" tabindex="-1"></a>Let $T$ denote the survival time, our goal is to characterize the distribution of $T$ using these 3 functions.</span>
<span id="cb21-280"><a href="#cb21-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-281"><a href="#cb21-281" aria-hidden="true" tabindex="-1"></a>Let $T$ be a discrete(or continuous) *iid* random variable and let $t_i$, be an occurrence of that variable, such that $Pr(t_i)=Pr(T=t_i)$</span>
<span id="cb21-282"><a href="#cb21-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-283"><a href="#cb21-283" aria-hidden="true" tabindex="-1"></a><span class="fu">### The distribution function, or *pdf*</span></span>
<span id="cb21-284"><a href="#cb21-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-285"><a href="#cb21-285" aria-hidden="true" tabindex="-1"></a>Like any other random variates survival times have a simple distribution function that gives the probability of observing a particular survival time within a finite interval</span>
<span id="cb21-286"><a href="#cb21-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-287"><a href="#cb21-287" aria-hidden="true" tabindex="-1"></a>The density function is defined as the limit of the probability that an individual fails (experiences the event) in a short interval $t+\Delta t$ (read delta t), per width of $\Delta t$, or simply the probability of failure in a small interval per unit time, $f(t_i) = Pr(T=t_i)$.</span>
<span id="cb21-288"><a href="#cb21-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-289"><a href="#cb21-289" aria-hidden="true" tabindex="-1"></a>If $F(t)$ is the cumulative distribution function for *T*, given by:</span>
<span id="cb21-290"><a href="#cb21-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-291"><a href="#cb21-291" aria-hidden="true" tabindex="-1"></a>$$ F(t) = \int_{0}^{t} f(u) du = Pr(T \leqslant t )$$ {#eq-1} Which is the probability of observing a value of *T* prior to the current value, *t*.</span>
<span id="cb21-292"><a href="#cb21-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-293"><a href="#cb21-293" aria-hidden="true" tabindex="-1"></a>The density function is then:</span>
<span id="cb21-294"><a href="#cb21-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-295"><a href="#cb21-295" aria-hidden="true" tabindex="-1"></a>$$ f(t) = \frac{F(t)}{d(t)} = F'(t)$$ {#eq-2} or</span>
<span id="cb21-296"><a href="#cb21-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-297"><a href="#cb21-297" aria-hidden="true" tabindex="-1"></a>$$ f(t) = \lim_{\delta t \rightarrow 0} \frac{F(t+\Delta t) - F(t)}{\Delta t}$$ {#eq-3}</span>
<span id="cb21-298"><a href="#cb21-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-299"><a href="#cb21-299" aria-hidden="true" tabindex="-1"></a>The density function gives the unconditional instantaneous failure rate in the (very small) interval between *t* and *dt*, $\Delta t$</span>
<span id="cb21-300"><a href="#cb21-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-301"><a href="#cb21-301" aria-hidden="true" tabindex="-1"></a><span class="fu">### Survival Function</span></span>
<span id="cb21-302"><a href="#cb21-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-303"><a href="#cb21-303" aria-hidden="true" tabindex="-1"></a>The survival function, *S(t)* is expressed:</span>
<span id="cb21-304"><a href="#cb21-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-305"><a href="#cb21-305" aria-hidden="true" tabindex="-1"></a>$$ S(t) = 1 - F(t) = Pr (T \geqslant t)$$ {#eq-4}</span>
<span id="cb21-306"><a href="#cb21-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-307"><a href="#cb21-307" aria-hidden="true" tabindex="-1"></a>Which is the probability that *T* takes a value larger than *t*. i.e. the event happens some time after the present time.</span>
<span id="cb21-308"><a href="#cb21-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-309"><a href="#cb21-309" aria-hidden="true" tabindex="-1"></a>At $t = 0, S(t) =1 \text { and at } t= \infty, \text { and } S(t) =0$</span>
<span id="cb21-310"><a href="#cb21-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-311"><a href="#cb21-311" aria-hidden="true" tabindex="-1"></a>As time passes, $S(t)$ decreases, and is called a *strictly decreasing function of time*.</span>
<span id="cb21-312"><a href="#cb21-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-313"><a href="#cb21-313" aria-hidden="true" tabindex="-1"></a>Empirically, $S(t)$ takes the form of a step function:</span>
<span id="cb21-314"><a href="#cb21-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-317"><a href="#cb21-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-318"><a href="#cb21-318" aria-hidden="true" tabindex="-1"></a>St<span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">-</span>(t1<span class="sc">$</span>Failing<span class="sc">/</span>t1<span class="sc">$</span>At_Risk)))</span>
<span id="cb21-319"><a href="#cb21-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-320"><a href="#cb21-320" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(St, <span class="at">type=</span><span class="st">"s"</span>,</span>
<span id="cb21-321"><a href="#cb21-321" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>,</span>
<span id="cb21-322"><a href="#cb21-322" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"S(t)"</span>,</span>
<span id="cb21-323"><a href="#cb21-323" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb21-324"><a href="#cb21-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-325"><a href="#cb21-325" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-326"><a href="#cb21-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-327"><a href="#cb21-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, eval=FALSE}</span></span>
<span id="cb21-328"><a href="#cb21-328" aria-hidden="true" tabindex="-1"></a>ht<span class="ot">&lt;-</span>t1<span class="sc">$</span>Failing<span class="sc">/</span>t1<span class="sc">$</span>At_Risk</span>
<span id="cb21-329"><a href="#cb21-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-330"><a href="#cb21-330" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ht, <span class="at">type=</span><span class="st">"s"</span>,</span>
<span id="cb21-331"><a href="#cb21-331" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Time"</span>,</span>
<span id="cb21-332"><a href="#cb21-332" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"h(t)"</span>,</span>
<span id="cb21-333"><a href="#cb21-333" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb21-334"><a href="#cb21-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-335"><a href="#cb21-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-336"><a href="#cb21-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-337"><a href="#cb21-337" aria-hidden="true" tabindex="-1"></a><span class="fu">### The hazard function</span></span>
<span id="cb21-338"><a href="#cb21-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-339"><a href="#cb21-339" aria-hidden="true" tabindex="-1"></a>The hazard function relates death, *f(t)*, and survival, *S(t)*, to one another</span>
<span id="cb21-340"><a href="#cb21-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-341"><a href="#cb21-341" aria-hidden="true" tabindex="-1"></a>$$h(t) = \frac{f(t)}{S(t)}$$ {#eq-5} $$h(t) = \lim_{\Delta t \rightarrow 0} \frac{Pr(t \leqslant T \leqslant t + \Delta t | T \geqslant t)}{\Delta t}$$ {#eq-6}</span>
<span id="cb21-342"><a href="#cb21-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-343"><a href="#cb21-343" aria-hidden="true" tabindex="-1"></a>Which is the failure rate per unit time in the interval *t*, $t+\Delta t$, the hazard may increase or decrease with time, or stay the same. This is really dependent on the distribution of failure times.</span>
<span id="cb21-344"><a href="#cb21-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-345"><a href="#cb21-345" aria-hidden="true" tabindex="-1"></a><span class="fu">## Relationships among the three functions</span></span>
<span id="cb21-346"><a href="#cb21-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-347"><a href="#cb21-347" aria-hidden="true" tabindex="-1"></a>If $ft = \frac{dF(t)}{dt}$ and $S(t) = 1- F(t)$ and, $h(t) = \frac{f(t)}{S(t)}$, then we can write:</span>
<span id="cb21-348"><a href="#cb21-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-349"><a href="#cb21-349" aria-hidden="true" tabindex="-1"></a>$$f(t) = \frac{-dS(t)}{dt}$$ {#eq-7}</span>
<span id="cb21-350"><a href="#cb21-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-351"><a href="#cb21-351" aria-hidden="true" tabindex="-1"></a>and the hazard function as:</span>
<span id="cb21-352"><a href="#cb21-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-353"><a href="#cb21-353" aria-hidden="true" tabindex="-1"></a>$$h(t) = \frac{-d \text{ log } S(t)}{dt}$$ {#eq-8}</span>
<span id="cb21-354"><a href="#cb21-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-355"><a href="#cb21-355" aria-hidden="true" tabindex="-1"></a>If we integrate this and let $S(0)=1$, then</span>
<span id="cb21-356"><a href="#cb21-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-357"><a href="#cb21-357" aria-hidden="true" tabindex="-1"></a>$$S(t) = exp^{-\int_{0}^t h(u) du} = e^{-H(t)}$$ {#eq-9}</span>
<span id="cb21-358"><a href="#cb21-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-359"><a href="#cb21-359" aria-hidden="true" tabindex="-1"></a>where the quantity, $H(t)$ is called the *cumulative hazard function* and,</span>
<span id="cb21-360"><a href="#cb21-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-361"><a href="#cb21-361" aria-hidden="true" tabindex="-1"></a>$H(t) = \int h(u) du$</span>
<span id="cb21-362"><a href="#cb21-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-363"><a href="#cb21-363" aria-hidden="true" tabindex="-1"></a>, then</span>
<span id="cb21-364"><a href="#cb21-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-365"><a href="#cb21-365" aria-hidden="true" tabindex="-1"></a>$$H(t) = -\text{log }  S(t)$$ {#eq-10}</span>
<span id="cb21-366"><a href="#cb21-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-367"><a href="#cb21-367" aria-hidden="true" tabindex="-1"></a>The density can be written as:</span>
<span id="cb21-368"><a href="#cb21-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-369"><a href="#cb21-369" aria-hidden="true" tabindex="-1"></a>$$f(t) = h(t) e ^{-H(t)}$$ {#eq-11} and</span>
<span id="cb21-370"><a href="#cb21-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-371"><a href="#cb21-371" aria-hidden="true" tabindex="-1"></a>$$h(t) = \frac{h(t) e^{-H(t)}}{e^{-H(t)}} = \frac{f(t)}{S(t)}$$ {#eq-12}</span>
<span id="cb21-372"><a href="#cb21-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-373"><a href="#cb21-373" aria-hidden="true" tabindex="-1"></a><span class="fu">### More on the hazard function...</span></span>
<span id="cb21-374"><a href="#cb21-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-375"><a href="#cb21-375" aria-hidden="true" tabindex="-1"></a>Unlike the *f(t)* or *S(t)*, *h(t)* describes the risk an individual faces of experiencing the event, given they have survived up to that time.</span>
<span id="cb21-376"><a href="#cb21-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-377"><a href="#cb21-377" aria-hidden="true" tabindex="-1"></a>This kind of conditional probability is of special interest to us.</span>
<span id="cb21-378"><a href="#cb21-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-379"><a href="#cb21-379" aria-hidden="true" tabindex="-1"></a>We can extend this framework to include effects of *individual characteristics on one's risk*, thus not only introducing dependence on time, but also on these characteristics (covariates).</span>
<span id="cb21-380"><a href="#cb21-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-381"><a href="#cb21-381" aria-hidden="true" tabindex="-1"></a>We can re-express the hazard rate with both these conditions as:</span>
<span id="cb21-382"><a href="#cb21-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-383"><a href="#cb21-383" aria-hidden="true" tabindex="-1"></a>$$h(t|x) = \lim_{\Delta t \rightarrow 0} \frac{Pr(t \leqslant T \leqslant t + \Delta t | T \geqslant t, x)}{\Delta t}$$ {#eq-13}</span>
<span id="cb21-384"><a href="#cb21-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-385"><a href="#cb21-385" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example from data</span></span>
<span id="cb21-386"><a href="#cb21-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-387"><a href="#cb21-387" aria-hidden="true" tabindex="-1"></a>This example will illustrate how to construct a basic survival function from individual-level data. The example will use as its outcome variable, the event of a child dying before age 1. The data for this example come from the <span class="co">[</span><span class="ot">Demographic and Health Survey Model Data Files</span><span class="co">](http://dhsprogram.com/data/Download-Model-Datasets.cfm?flag=1)</span> children's recode file.</span>
<span id="cb21-388"><a href="#cb21-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-389"><a href="#cb21-389" aria-hidden="true" tabindex="-1"></a>The DHS Program has created example data sets for users to practice with. These data sets have been created strictly for practice and do not represent any actual country's data. See more <span class="co">[</span><span class="ot">here</span><span class="co">](http://dhsprogram.com/data/Download-Model-Datasets.cfm?flag=1#sthash.HRINGQ00.dpuf)</span>.</span>
<span id="cb21-390"><a href="#cb21-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-391"><a href="#cb21-391" aria-hidden="true" tabindex="-1"></a>This file contains information for all births to the sample of women between the ages of 15 and 49 in the last 5 years prior to the survey.</span>
<span id="cb21-392"><a href="#cb21-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-395"><a href="#cb21-395" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-396"><a href="#cb21-396" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb21-397"><a href="#cb21-397" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb21-398"><a href="#cb21-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-399"><a href="#cb21-399" aria-hidden="true" tabindex="-1"></a>model.dat<span class="ot">&lt;-</span><span class="fu">read_dta</span>(<span class="st">"https://github.com/coreysparks/data/blob/master/ZZKR62FL.DTA?raw=true"</span>)</span>
<span id="cb21-400"><a href="#cb21-400" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-401"><a href="#cb21-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-402"><a href="#cb21-402" aria-hidden="true" tabindex="-1"></a><span class="fu">## Event - Infant Mortality</span></span>
<span id="cb21-403"><a href="#cb21-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-404"><a href="#cb21-404" aria-hidden="true" tabindex="-1"></a>In the DHS, they record if a child is dead or alive and the age at death if the child is dead. This can be understood using a series of variables about each child.</span>
<span id="cb21-405"><a href="#cb21-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-406"><a href="#cb21-406" aria-hidden="true" tabindex="-1"></a>If the child is alive at the time of interview, then the variable B5==1, and the age at death is censored.</span>
<span id="cb21-407"><a href="#cb21-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-408"><a href="#cb21-408" aria-hidden="true" tabindex="-1"></a>If the age at death is censored, then the age at the date of interview (censored age at death) is the date of the interview - date of birth (in months).</span>
<span id="cb21-409"><a href="#cb21-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-410"><a href="#cb21-410" aria-hidden="true" tabindex="-1"></a>If the child is dead at the time of interview,then the variable B5!=1, then the age at death in months is the variable B7. Here we code this:</span>
<span id="cb21-411"><a href="#cb21-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-414"><a href="#cb21-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-415"><a href="#cb21-415" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb21-416"><a href="#cb21-416" aria-hidden="true" tabindex="-1"></a>model.dat<span class="ot">&lt;-</span> model.dat<span class="sc">%&gt;%</span></span>
<span id="cb21-417"><a href="#cb21-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">death.age =</span> <span class="fu">ifelse</span>(b5<span class="sc">==</span><span class="dv">1</span>,</span>
<span id="cb21-418"><a href="#cb21-418" aria-hidden="true" tabindex="-1"></a>                          ((((v008))<span class="sc">+</span><span class="dv">1900</span>)<span class="sc">-</span>(((b3))<span class="sc">+</span><span class="dv">1900</span>)) </span>
<span id="cb21-419"><a href="#cb21-419" aria-hidden="true" tabindex="-1"></a>                          ,b7), </span>
<span id="cb21-420"><a href="#cb21-420" aria-hidden="true" tabindex="-1"></a><span class="co">#censoring indicator for death by age 1, in months (12 months)</span></span>
<span id="cb21-421"><a href="#cb21-421" aria-hidden="true" tabindex="-1"></a>          <span class="at">d.event =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(b7)<span class="sc">==</span>T<span class="sc">|</span>b7<span class="sc">&gt;</span><span class="dv">12</span>,<span class="dv">0</span>,<span class="dv">1</span>), </span>
<span id="cb21-422"><a href="#cb21-422" aria-hidden="true" tabindex="-1"></a>          <span class="at">d.eventfac =</span> <span class="fu">factor</span>(d.event, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Alive at 1"</span>, <span class="st">"Dead by 1"</span>)))</span>
<span id="cb21-423"><a href="#cb21-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-424"><a href="#cb21-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-425"><a href="#cb21-425" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(model.dat<span class="sc">$</span>d.eventfac)</span>
<span id="cb21-426"><a href="#cb21-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-427"><a href="#cb21-427" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-428"><a href="#cb21-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-429"><a href="#cb21-429" aria-hidden="true" tabindex="-1"></a>We see <span class="in">`r table(model.dat$d.eventfac)[2]`</span> infant deaths among the <span class="in">`r dim(model.dat)[1]`</span> births in the last 5 years.</span>
<span id="cb21-430"><a href="#cb21-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-431"><a href="#cb21-431" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example of Estimating Survival Time Functions from data</span></span>
<span id="cb21-432"><a href="#cb21-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-433"><a href="#cb21-433" aria-hidden="true" tabindex="-1"></a>To generate a basic life table, we use the <span class="in">`survfit()`</span> procedure in the <span class="in">`survival`</span> library. The data for this is a <span class="in">`Surv()`</span> object, which typically has 2 arguments, the duration, and the censoring indicator. This uses age at death (the <span class="in">`death.age`</span> variable from above) for children dying before age 1 as the outcome, and the <span class="in">`d.event`</span> variable from above as the censoring indicator.</span>
<span id="cb21-434"><a href="#cb21-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-437"><a href="#cb21-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-438"><a href="#cb21-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Here we see the data</span></span>
<span id="cb21-439"><a href="#cb21-439" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">head</span>(model.dat[,<span class="fu">c</span>(<span class="st">"death.age"</span>,<span class="st">"d.event"</span>)], <span class="at">n=</span><span class="dv">20</span>))</span>
<span id="cb21-440"><a href="#cb21-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-441"><a href="#cb21-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-444"><a href="#cb21-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-445"><a href="#cb21-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: The Surv() object</span></span>
<span id="cb21-446"><a href="#cb21-446" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">Surv</span>(model.dat<span class="sc">$</span>death.age, model.dat<span class="sc">$</span>d.event), <span class="at">n=</span><span class="dv">20</span>)</span>
<span id="cb21-447"><a href="#cb21-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-448"><a href="#cb21-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-449"><a href="#cb21-449" aria-hidden="true" tabindex="-1"></a>In the first 20 cases from the data, several children died (no <span class="in">`+`</span> after the time), while all the other children had not experienced the event (they were still alive at age 12 months), these have a <span class="in">`+`</span> after their censored age at death.</span>
<span id="cb21-450"><a href="#cb21-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-451"><a href="#cb21-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=8}</span></span>
<span id="cb21-452"><a href="#cb21-452" aria-hidden="true" tabindex="-1"></a>mort<span class="ot">&lt;-</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(death.age, d.event)<span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb21-453"><a href="#cb21-453" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>model.dat,</span>
<span id="cb21-454"><a href="#cb21-454" aria-hidden="true" tabindex="-1"></a>              <span class="at">conf.type=</span><span class="st">"none"</span>)</span>
<span id="cb21-455"><a href="#cb21-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-456"><a href="#cb21-456" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mort, <span class="at">ylim=</span><span class="fu">c</span>(.<span class="dv">9</span>,<span class="dv">1</span>),</span>
<span id="cb21-457"><a href="#cb21-457" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>),</span>
<span id="cb21-458"><a href="#cb21-458" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Survival Function for Infant Mortality"</span>)</span>
<span id="cb21-459"><a href="#cb21-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-460"><a href="#cb21-460" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mort)</span>
<span id="cb21-461"><a href="#cb21-461" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-462"><a href="#cb21-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-463"><a href="#cb21-463" aria-hidden="true" tabindex="-1"></a>This is the so-called Kaplan-Meier estimate of the survival function. At each month, we see the number of children at risk and the number dying. We see the highest number of deaths occurred between 0 and 1 month, which is not surprising.</span>
<span id="cb21-464"><a href="#cb21-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-465"><a href="#cb21-465" aria-hidden="true" tabindex="-1"></a>The estimate is that the infant morality rate is <span class="in">`r 1000*(1-summary(mort)$surv[12])`</span> , I get this by doing <span class="in">`1000*(1-summary(mort)$surv[12])`</span>.</span>
<span id="cb21-466"><a href="#cb21-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-467"><a href="#cb21-467" aria-hidden="true" tabindex="-1"></a>We can likewise get an estimate of the hazard function using the Kaplan-Meier method as well, using the <span class="in">`muhaz`</span> library.</span>
<span id="cb21-468"><a href="#cb21-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-471"><a href="#cb21-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb21-472"><a href="#cb21-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 7</span></span>
<span id="cb21-473"><a href="#cb21-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb21-474"><a href="#cb21-474" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb21-475"><a href="#cb21-475" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(muhaz)</span>
<span id="cb21-476"><a href="#cb21-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-477"><a href="#cb21-477" aria-hidden="true" tabindex="-1"></a>haz<span class="ot">&lt;-</span><span class="fu">kphaz.fit</span>(<span class="at">time=</span>model.dat<span class="sc">$</span>death.age, </span>
<span id="cb21-478"><a href="#cb21-478" aria-hidden="true" tabindex="-1"></a>               <span class="at">status=</span>model.dat<span class="sc">$</span>d.event,</span>
<span id="cb21-479"><a href="#cb21-479" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">"product-limit"</span>)</span>
<span id="cb21-480"><a href="#cb21-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-481"><a href="#cb21-481" aria-hidden="true" tabindex="-1"></a><span class="fu">kphaz.plot</span>(haz,</span>
<span id="cb21-482"><a href="#cb21-482" aria-hidden="true" tabindex="-1"></a>           <span class="at">main=</span><span class="st">"Hazard function plot"</span>)</span>
<span id="cb21-483"><a href="#cb21-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-484"><a href="#cb21-484" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(haz)</span>
<span id="cb21-485"><a href="#cb21-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-486"><a href="#cb21-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-487"><a href="#cb21-487" aria-hidden="true" tabindex="-1"></a>This illustrates, that while the largest drop in survivorship occurred between 0 and 1, the hazard is actually higher in the 1-3 month range, illustrating the conditional nature of that probability. There is also a large jump in risk at age 1, which may indicate something about age-heaping in the data.</span>
<span id="cb21-488"><a href="#cb21-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-489"><a href="#cb21-489" aria-hidden="true" tabindex="-1"></a>Now we have our $S(t)$ and $h(t)$ functions. We can derive the other functions of survival time from these but integrating (summing) and differentiating these functions.</span>
<span id="cb21-490"><a href="#cb21-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-491"><a href="#cb21-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.height=7, fig.width=8}</span></span>
<span id="cb21-492"><a href="#cb21-492" aria-hidden="true" tabindex="-1"></a><span class="co">#cumulative hazard</span></span>
<span id="cb21-493"><a href="#cb21-493" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">cumsum</span>(haz<span class="sc">$</span>haz)<span class="sc">~</span>haz<span class="sc">$</span>time, </span>
<span id="cb21-494"><a href="#cb21-494" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Cumulative Hazard function"</span>,</span>
<span id="cb21-495"><a href="#cb21-495" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"H(t)"</span>,<span class="at">xlab=</span><span class="st">"Time in Months"</span>, </span>
<span id="cb21-496"><a href="#cb21-496" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"l"</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">12</span>), <span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">3</span>)</span>
<span id="cb21-497"><a href="#cb21-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-498"><a href="#cb21-498" aria-hidden="true" tabindex="-1"></a><span class="co">#Survival function, I just store this in an object so I can use it</span></span>
<span id="cb21-499"><a href="#cb21-499" aria-hidden="true" tabindex="-1"></a>surv<span class="ot">&lt;-</span>mort</span>
<span id="cb21-500"><a href="#cb21-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-501"><a href="#cb21-501" aria-hidden="true" tabindex="-1"></a><span class="co">#here is a cheap version of the pdf</span></span>
<span id="cb21-502"><a href="#cb21-502" aria-hidden="true" tabindex="-1"></a>ft<span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">diff</span>(mort<span class="sc">$</span>surv)</span>
<span id="cb21-503"><a href="#cb21-503" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ft, <span class="at">xlim=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="fl">11.5</span>), </span>
<span id="cb21-504"><a href="#cb21-504" aria-hidden="true" tabindex="-1"></a>     <span class="at">type=</span><span class="st">"s"</span>,</span>
<span id="cb21-505"><a href="#cb21-505" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"f(t)"</span>,<span class="at">xlab=</span><span class="st">"Time in Months"</span>,</span>
<span id="cb21-506"><a href="#cb21-506" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Probability Density Function"</span>)</span>
<span id="cb21-507"><a href="#cb21-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-508"><a href="#cb21-508" aria-hidden="true" tabindex="-1"></a><span class="co">#here is the cumulative distribution function</span></span>
<span id="cb21-509"><a href="#cb21-509" aria-hidden="true" tabindex="-1"></a>Ft<span class="ot">&lt;-</span><span class="fu">cumsum</span>(ft)</span>
<span id="cb21-510"><a href="#cb21-510" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Ft, <span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="dv">12</span>), <span class="at">type=</span><span class="st">"s"</span>, <span class="at">ylab=</span><span class="st">"F(t)"</span>,<span class="at">xlab=</span><span class="st">"Time in Months"</span>, <span class="at">main=</span><span class="st">"Cumulative Distribution Function"</span>)</span>
<span id="cb21-511"><a href="#cb21-511" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-512"><a href="#cb21-512" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb21-513"><a href="#cb21-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-514"><a href="#cb21-514" aria-hidden="true" tabindex="-1"></a>So in this example, we calculated the censored ages at death for children under age 1, we estimated the survival function, hazard and Cumulative hazard functions, and the associated pdf and cdf's.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>